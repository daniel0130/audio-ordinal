<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Bitcoin Audional Generator</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        background-color: #202020;
        color: white;
        font-family: "ShareTechMono-Regular", Arial, sans-serif;
        width: 100vw;
        overflow-x: hidden;
      }
      .header {
        align-items: center;
        background-color: black;
        display: flex;
        height: 100px;
        justify-content: space-between;
        width: 100vw;
      }
      .header img {
        height: 100%;
      }
      .header h1 {
        color: white;
        flex-grow: 2;
        font-size: 6em;
        text-align: center;
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        margin: 0 -5px;
      }
      .column {
        flex: 33.33%;
        padding: 5px 5px;
      }
      .form-group {
        margin-bottom: 10px;
      }
      label {
        display: block;
        margin-bottom: 5px;
      }
      input[type="text"],
      textarea,
      datalist,
      input[type="checkbox"],
      input[type="file"],
      input[type="number"] {
        box-sizing: border-box;
        height: 25px;
        padding: 0;
        width: 100%;
      }
      .input-wrapper {
        padding: 10px;
      }

      .form-group input[type="text"],
      .form-group textarea,
      .form-group datalist,
      .form-group input[type="file"],
      .form-group input[type="number"] {
        width: 100%;
      }
      button {
        background-color: #0066ff;
        border: none;
        color: white;
        cursor: pointer;
        padding: 10px 20px;
      }
      button:disabled {
        background-color: #555;
      }
      .flashing {
        animation: flash 2s linear infinite;
        background-color: red;
      }
      @keyframes flash {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.1;
        }
        100% {
          opacity: 1;
        }
      }
      #json-output {
        margin-top: 20px;
        word-wrap: break-word;
      }
      .info-button {
        /* Center the button horizontally */
        display: block;
        margin: 0 auto;
        text-align: center;

        /* Set the button color to green */
        background-color: red;

        /* Additional button styles */
        border: none;
        color: white;
        cursor: pointer;
        padding: 10px 20px;
      }
      .info-content {
        display: none;
        margin-top: 20px;
        padding: 20px;
        background-color: #333333;
        color: white;
      }
    </style>
    <script>
      function toggleInfo() {
        var infoContent = document.getElementById("info-content");
        if (
          infoContent.style.display === "none" ||
          infoContent.style.display === ""
        ) {
          infoContent.style.display = "block";
        } else {
          infoContent.style.display = "none";
        }
      }
    </script>
  </head>
  <body>
    <div class="header">
      <img src="AudionalsLogo.png" alt="Audionals Logo" />
      <h1>Audionals.com</h1>
      <img src="AudionalsLogo.png" alt="Audionals Logo" />
    </div>
    <button class="info-button" onclick="toggleInfo()">
      What are Audionals?
    </button>

    <div class="info-content" id="info-content">
      <p>
        Audionals are a groundbreaking new standard for inscribing audio files
        on the Bitcoin blockchain, providing a unique tool for musicians, sound
        designers, music enthusiasts and audiophile collectors alike. The
        platform takes advantage of the transparent, immutable nature of the
        blockchain, offering a unique method of inscribing audio directly onto
        the blockchain. The innovative approach taken by Audionals.com might
        very well disrupt the traditional music industry and usher in a new era
        of audio content creation, distribution, and ownership.
      </p>
      <br />
      <p>
        The fundamental technology that drives Audionals.com is the inscription
        of audio data to the blockchain in the form of Base64 embedded JSON
        files. Audio files uploaded to the platform are encoded into a format
        known as Base64, which transforms the binary data into a string of ASCII
        characters. This audio data is then embedded within a JSON (JavaScript
        Object Notation) file, a lightweight data-interchange format that is
        easy for humans to read and write and easy for machines to parse and
        generate.
      </p>
      <br />
      <p>
        The strength of this approach is two-fold. First, the use of JSON format
        makes the audio data easily indexable and sortable. Metadata such as the
        audio type, the instrument used, genre, key, BPM, and user-defined
        parameters can be added to the JSON file, which facilitates searching,
        categorisation, and manipulation of the audio files on the platform. It
        essentially creates a database of audio files that are easily searchable
        and sortable, making it user-friendly and efficient.
      </p>
      <br />
      <p>
        Second, the inscribing of audio data directly onto the blockchain has
        profound implications for ownership, copyright, and authenticity. Once a
        piece of audio is inscribed onto the blockchain, it is permanent and
        immutable. It cannot be altered or deleted, and the ownership is
        transparent. This technology could revolutionise the way music
        copyrights are handled, providing an indisputable record of original
        content.
      </p>
      <br />
      <p>
        Furthermore, all audionals can be subjected to recursive techniques,
        pulling together these Base64 encoded samples to form new sequences,
        enabling users to compose and save music directly on-chain. This
        provides musicians with a new way of creating and storing their work,
        eliminating the need for external storage devices or services. By
        leveraging audional technology and the immutable nature of the
        blockchain, musicians can establish verifiable ownership and track their
        samples and compositions with ease. The transparency and traceability
        offered by audional technology enable accurate royalty distribution and
        tracking, revolutionising the way musicians receive recognition and
        income for their work.
      </p>
      <br />
      <p>
        In essence, Audionals.com represents a novel application of blockchain
        technology in the realm of audio and music. Its unique approach to audio
        inscription, coupled with the innovative on-chain composition feature,
        is poised to disrupt the traditional music industry and empower artists
        in unprecedented ways. In a world where digital technology continues to
        reshape the way we create, distribute, and consume music, Audionals.com
        offers a glimpse into a future where music and blockchain become
        inextricably linked.
      </p>
    </div>
    <h1>Bitcoin Audional Generator</h1>
    <main id="app" role="main">
      <fieldset class="form-group">
        <legend>Select an MP3 or WAV file:</legend>
        <div class="input-wrapper">
          <input
            id="file"
            type="file"
            class="input-width flashing"
            accept=".mp3, .wav"
          />
        </div>
      </fieldset>

      <button id="process" disabled>Process Audio File</button>

      <section class="row">
        <article class="column">
          <fieldset class="form-group">
            <legend>File Details:</legend>

            <div class="input-wrapper">
              <label for="fileName">File Name:</label>
              <input
                type="text"
                id="fileName"
                readonly
                placeholder="E.G. Snare1.wav"
              />
            </div>

            <div class="input-wrapper">
              <label for="audio_type">Audio Type:</label>
              <input
                id="audio_type"
                type="text"
                list="audio_types"
                placeholder="E.G. music"
              />
              <datalist id="audio_types">
                <option value="music"></option>
                <option value="speech"></option>
                <option value="nature"></option>
                <option value="sfx"></option>
                <option value="other"></option>
              </datalist>
            </div>

            <div class="input-wrapper">
              <label for="duration">Duration (seconds):</label>
              <input
                type="text"
                id="duration"
                readonly
                placeholder="E.G. 0.300"
              />
            </div>
          </fieldset>
        </article>

        <article class="column">
          <fieldset class="form-group">
            <legend>Music Sample Metadata:</legend>

            <div class="input-wrapper">
              <label for="instrument">Instrument Group:</label>
              <input type="text" id="instrument" placeholder="E.G. Drums" />
            </div>

            <div class="input-wrapper">
              <label for="instrument_specifics">Instrument Specifics:</label>
              <input
                type="text"
                id="instrument_specifics"
                placeholder="E.G Snare"
              />
            </div>

            <div class="input-wrapper">
              <label for="note">Note (select from list):</label>
              <input
                type="text"
                id="note"
                list="note_options"
                placeholder="E.G. G1"
              />
              <datalist id="note_options">
                <option value="C0"></option>
                <option value="C#0"></option>
                <option value="D0"></option>
                <option value="D#0"></option>
                <option value="E0"></option>
                <option value="F0"></option>
                <option value="F#0"></option>
                <option value="G0"></option>
                <option value="G#0"></option>
                <option value="A0"></option>
                <option value="A#0"></option>
                <option value="B0"></option>

                <option value="C1"></option>
                <option value="C#1"></option>
                <option value="D1"></option>
                <option value="D#1"></option>
                <option value="E1"></option>
                <option value="F1"></option>
                <option value="F#1"></option>
                <option value="G1"></option>
                <option value="G#1"></option>
                <option value="A1"></option>
                <option value="A#1"></option>
                <option value="B1"></option>

                <option value="C2"></option>
                <option value="C#2"></option>
                <option value="D2"></option>
                <option value="D#2"></option>
                <option value="E2"></option>
                <option value="F2"></option>
                <option value="F#2"></option>
                <option value="G2"></option>
                <option value="G#2"></option>
                <option value="A2"></option>
                <option value="A#2"></option>
                <option value="B2"></option>

                <option value="C3"></option>
                <option value="C#3"></option>
                <option value="D3"></option>
                <option value="D#3"></option>
                <option value="E3"></option>
                <option value="F3"></option>
                <option value="F#3"></option>
                <option value="G3"></option>
                <option value="G#3"></option>
                <option value="A3"></option>
                <option value="A#3"></option>
                <option value="B3"></option>

                <option value="C4"></option>
                <option value="C#4"></option>
                <option value="D4"></option>
                <option value="D#4"></option>
                <option value="E4"></option>
                <option value="F4"></option>
                <option value="F#4"></option>
                <option value="G4"></option>
                <option value="G#4"></option>
                <option value="A4"></option>
                <option value="A#4"></option>
                <option value="B4"></option>

                <option value="C5"></option>
                <option value="C#5"></option>
                <option value="D5"></option>
                <option value="D#5"></option>
                <option value="E5"></option>
                <option value="F5"></option>
                <option value="F#5"></option>
                <option value="G5"></option>
                <option value="G#5"></option>
                <option value="A5"></option>
                <option value="A#5"></option>
                <option value="B5"></option>

                <option value="C6"></option>
                <option value="C#6"></option>
                <option value="D6"></option>
                <option value="D#6"></option>
                <option value="E6"></option>
                <option value="F6"></option>
                <option value="F#6"></option>
                <option value="G6"></option>
                <option value="G#6"></option>
                <option value="A6"></option>
                <option value="A#6"></option>
                <option value="B6"></option>

                <option value="C7"></option>
                <option value="C#7"></option>
                <option value="D7"></option>
                <option value="D#7"></option>
                <option value="E7"></option>
                <option value="F7"></option>
                <option value="F#7"></option>
                <option value="G7"></option>
                <option value="G#7"></option>
                <option value="A7"></option>
                <option value="A#7"></option>
                <option value="B7"></option>

                <option value="C8"></option>
                <option value="C#8"></option>
                <option value="D8"></option>
                <option value="D#8"></option>
                <option value="E8"></option>
                <option value="F8"></option>
                <option value="F#8"></option>
                <option value="G8"></option>
                <option value="G#8"></option>
                <option value="A8"></option>
                <option value="A#8"></option>
                <option value="B8"></option>
              </datalist>
            </div>

            <div class="input-wrapper">
              <label for="key">Key (select from list):</label>
              <input
                type="text"
                id="key"
                list="key_options"
                placeholder="E.G. G Major"
              />
              <datalist id="key_options">
                <option value="C Major"></option>
                <option value="C# Major"></option>
                <option value="D Major"></option>
                <option value="D# Major"></option>
                <option value="E Major"></option>
                <option value="F Major"></option>
                <option value="F# Major"></option>
                <option value="G Major"></option>
                <option value="G# Major"></option>
                <option value="A Major"></option>
                <option value="A# Major"></option>
                <option value="B Major"></option>
                <option value="C Minor"></option>
                <option value="C# Minor"></option>
                <option value="D Minor"></option>
                <option value="D# Minor"></option>
                <option value="E Minor"></option>
                <option value="F Minor"></option>
                <option value="F# Minor"></option>
                <option value="G Minor"></option>
                <option value="G# Minor"></option>
                <option value="A Minor"></option>
                <option value="A# Minor"></option>
                <option value="B Minor"></option>
              </datalist>
            </div>
          </fieldset>
        </article>

        <article class="column">
          <fieldset class="form-group">
            <legend>Additional Details:</legend>

            <div class="input-wrapper">
              <label for="genre">Genre:</label>
              <input type="text" id="genre" placeholder="E.G. Jazz" />
            </div>

            <div class="input-wrapper">
              <label for="isLoop">Is this sample a loop?</label>
              <input
                id="isLoop"
                type="text"
                list="loop_options"
                placeholder="Yes or No"
                class="form-control last-input"
              />
              <datalist id="loop_options">
                <option value="Yes"></option>
                <option value="No"></option>
              </datalist>
            </div>

            <div class="input-wrapper">
              <label for="bpm" style="height: 25px">BPM (e.g. 125):</label>
              <input
                type="number"
                id="bpm"
                min="0"
                max="999"
                inputmode="numeric"
                pattern="[0-9]{1,3}"
                placeholder="E.G. 120"
                class="form-control last-input"
              />
            </div>
          </fieldset>
        </article>
      </section>

      <fieldset class="form-group">
        <legend>
          User Defined (e.g. additional details not included any of the fields
          above)
        </legend>
        <div class="input-wrapper">
          <textarea
            id="user-defined"
            class="input-width"
            placeholder="E.G. Synth loop from Entertainment by Melophonic"
          ></textarea>
        </div>
      </fieldset>

      <p id="reminder" style="color: grey; font-weight: bold">
        Have you filled as many of the fields above as you can?<br />More detail
        means better indexing which means more users can find your samples!<br />If
        yes, go ahead and:
      </p>

      <button id="convert" disabled>Generate Audional JSON File</button>
      <button id="inscribeButton" disabled>Check Inscription Price</button>
      <output id="json-output"></output>
    </main>

    <script>
      var inscribeButton = document.getElementById("inscribeButton");
      var audionalJson;
      const BASE_URL = "https://api-ordinals.gamma.io/inscription/v1";
      let apiKey;
      let feeRates = {};
      let calculatedFee = {};
      let inscriptionPreviewData = {};
      let audionalJsonString;

      // Fetch API key initially
      getApiKey();

      // Assume audionalJson exists and convert it to a string
      if (window.audionalJson) {
        audionalJsonString = JSON.stringify(window.audionalJson, null, 2);
      }

      window.onload = function () {
        // Call API functions immediately on page load
        if (audionalJsonString) {
          calculateInscriptionRequestFee(audionalJsonString);
          getInscriptionPreview(audionalJsonString, "audional.json"); // replace "audional.json" with actual filename if necessary
        }
      };

      // Disable typing in the audio type input
      var audioTypeInput = document.getElementById("audio_type");
      audioTypeInput.addEventListener("keydown", function (e) {
        e.preventDefault();
      });

      // Utility functions
      function generateRandomBase64String(length) {
        var chars =
          "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ+/";
        var result = "";
        for (var i = length; i > 0; --i)
          result += chars[Math.floor(Math.random() * chars.length)];
        return result;
      }

      function generateId() {
        var timestamp = Math.floor(Date.now() / 1000);
        var timestampHex = timestamp.toString(16);
        var uniqueRandomBase64 = generateRandomBase64String(7);
        return timestampHex + uniqueRandomBase64;
      }

      // Store elements to avoid repeated DOM queries
      const fileInput = document.getElementById("file");
      const processButton = document.getElementById("process");
      const convertButton = document.getElementById("convert");
      const reminder = document.getElementById("reminder");

      // Error container for user-friendly error messages
      const errorContainer = document.createElement("div");
      errorContainer.id = "error-container";
      document.body.appendChild(errorContainer);

      // Main code
      var audioContext = new (window.AudioContext ||
        window.webkitAudioContext)();

      // Make the fileInput button flash when the page loads
      fileInput.classList.add("flashing");

      fileInput.addEventListener("change", function () {
        var file = fileInput.files[0];
        if (file) {
          var fileType = file.name.split(".").pop();
          if (fileType !== "mp3" && fileType !== "wav") {
            errorContainer.innerHTML =
              "Invalid file type. Please select a .mp3 or .wav file.";
            fileInput.value = ""; // Clear the input.
            return;
          }
        }
        // Remove the flashing class from the file input field
        fileInput.classList.remove("flashing");
        fileInput.style.backgroundColor = "green";

        // Reset the process button to its original state
        processButton.innerText = "Process Audio File";
        processButton.disabled = false;
        processButton.classList.add("flashing");

        // Reset the audio type input
        audioTypeInput.value = "";

        // Disable the convert button
        convertButton.innerText = "Generate Audional json File";
        convertButton.disabled = true;
        convertButton.classList.remove("flashing");
        convertButton.style.backgroundColor = "grey";
      });

      processButton.addEventListener("click", function () {
        document.getElementById("reminder").style.color = "red";

        if (!audioTypeInput.value) {
          document.getElementById("reminder").innerText =
            "Please select the Audio Type and fill any other relevant fields before creating your Audional file!";
          convertButton.disabled = true;
        } else {
          document.getElementById("reminder").innerText =
            "Have you filled as many of the fields above as you can?\nMore detail equals better indexing which equals more users finding your samples!\nIf yes, go ahead and:";
          convertButton.disabled = false;
          convertButton.classList.add("flashing");
        }

        // Handle button flashing
        convertButton.addEventListener("animationiteration", function () {
          convertButton.style.backgroundColor =
            convertButton.style.backgroundColor === "red" ? "" : "red";
        });

        audioTypeInput.addEventListener("input", function () {
          if (audioTypeInput.value) {
            document.getElementById("reminder").innerText =
              "Have you filled as many of the fields above as you can?\nMore detail equals better indexing which equals more users finding your samples!\nIf yes, go ahead and:";
            convertButton.disabled = false;
            convertButton.classList.add("flashing");
          }
        });

        var file = fileInput.files[0];
        if (!file) {
          alert("Please select a file.");
          return;
        }

        var reader = new FileReader();
        reader.onload = function (e) {
          var audioData = e.target.result;

          audioContext.decodeAudioData(audioData, function (buffer) {
            var duration = buffer.duration;

            fileInput.sampleRate = buffer.sampleRate;
            fileInput.numberOfChannels = buffer.numberOfChannels;

            document.getElementById("duration").value = duration.toFixed(3);
            document.getElementById("fileName").value = file.name;

            processButton.classList.remove("flashing");
            processButton.style.backgroundColor = "green";
            processButton.innerText = "File Processed";
            convertButton.disabled = false;
            convertButton.classList.add("flashing");

            document.getElementById("fileName").readOnly = true;
            document.getElementById("duration").readOnly = true;

            document.getElementById("reminder").style.color = "red"; // added this line
          });
        };
        reader.onerror = function () {
          alert("Error reading file");
        };
        reader.readAsArrayBuffer(file);
      });

      convertButton.addEventListener("click", function () {
        var audioTypeInput = document.getElementById("audio_type");
        var fileInput = document.getElementById("file");
        var instrumentInput = document.getElementById("instrument");
        var instrumentSpecificsInput = document.getElementById(
          "instrument_specifics"
        );
        var genreInput = document.getElementById("genre");
        var keyInput = document.getElementById("key");
        var bpmInput = document.getElementById("bpm");
        var userDefinedInput = document.getElementById("user-defined");
        var noteInput = document.getElementById("note");
        var isLoopInput = document.getElementById("isLoop");
        var isLoop = isLoopInput.value.toLowerCase() === "yes" ? true : false;

        var reader = new FileReader();
        reader.onload = function (e) {
          var audioData = e.target.result;

          audioContext.decodeAudioData(audioData, function (buffer) {
            var duration = buffer.duration;

            fileInput.sampleRate = buffer.sampleRate;
            fileInput.numberOfChannels = buffer.numberOfChannels;

            document.getElementById("duration").value = duration.toFixed(3);
            document.getElementById("fileName").value = file.name;

            processButton.classList.remove("flashing");
            processButton.style.backgroundColor = "green";
            processButton.innerText = "File Processed";
            convertButton.disabled = false;
            convertButton.classList.add("flashing");

            document.getElementById("fileName").readOnly = true;
            document.getElementById("duration").readOnly = true;

            document.getElementById("reminder").style.color = "red";
          });
        };
        reader.onerror = function () {
          alert("Error reading file");
        };
        reader.readAsArrayBuffer(file);
      });

      convertButton.addEventListener("click", function () {
        var audioTypeInput = document.getElementById("audio_type");
        var fileInput = document.getElementById("file");
        var instrumentInput = document.getElementById("instrument");
        var instrumentSpecificsInput = document.getElementById(
          "instrument_specifics"
        );
        var genreInput = document.getElementById("genre");
        var keyInput = document.getElementById("key");
        var bpmInput = document.getElementById("bpm");
        var userDefinedInput = document.getElementById("user-defined");
        var noteInput = document.getElementById("note");
        var isLoopInput = document.getElementById("isLoop");
        var isLoop = isLoopInput.value.toLowerCase() === "yes" ? true : false;

        var file = fileInput.files[0];
        if (!file) {
          alert("Please select a file.");
          return;
        }
        if (!audioTypeInput.value) {
          alert(
            "Please select the Audio Type and add details to other fields if known."
          );
          return;
        }

        var reader = new FileReader();
        reader.onload = function (e) {
          var base64Audio = e.target.result;

          var filenameWithoutExtension = file.name.replace(/\.[^/.]+$/, "");

          var duration = parseFloat(document.getElementById("duration").value);
          var bpm = parseFloat(bpmInput.value);
          var loopGap;
          if (bpm) {
            var beatsPerSecond = bpm / 60;
            var beatsInDuration = duration * beatsPerSecond;

            loopGap = Math.max(1, Math.round(beatsInDuration));
          } else {
            loopGap = duration * 2;
          }
          // Calculate the loop BPM
          var loopBPM;
          if (duration) {
            loopBPM = 60 / duration;
          }

          var audionalJson = {
            protocol: "audional",
            operation: "deploy",
            audionalId: generateId(),
            filename: file.name,
            audioData: base64Audio,
            metadata: {
              descriptive: {
                title: "Title of the Audio",
                creator: "Name of Creator",
                inscribersAddress: "Bitcoin Address",
                description: "Brief description about the audio",
                audioType: audioTypeInput.value,
                instrument: instrumentInput.value,
                instrumentSpecifics: instrumentSpecificsInput.value,
                genre: genreInput.value,
                key: keyInput.value,
                speechSpecific: {
                  language: "Language of Speech",
                  speaker: "Speaker Name",
                  context: "Speech Context",
                },
                natureSpecific: {
                  environment: "Type of Environment",
                  timeOfDay: "Time of Day",
                  weatherConditions: "Weather Conditions",
                  animalSounds: {
                    animalSpecies: "Species of Animal",
                    animalBehavior: "Behavioral Context of the Sound",
                    groupSize: "Size of the Animal Group",
                  },
                  geographicLocation: "Exact Geographic Location",
                  season: "Season during the Recording",
                  naturalPhenomenon:
                    "Specific Natural Phenomenon (e.g. Thunderstorm, Waterfall, etc.)",
                },
                sfxSpecific: {
                  source: "Source of Sound Effect",
                  method: "Method of Production",
                },
                otherSpecific: {
                  customField1: "Custom Field Value",
                  customField2: "Custom Field Value",
                },
              },
              technical: {
                encodingFormat: "Base64",
                sampleRate: fileInput.sampleRate,
                numberOfChannels: fileInput.numberOfChannels,
                bitDepth: "Bit Depth of the Audio",
                duration: document.getElementById("duration").value,
              },
              structural: {
                sequenceInfo:
                  "Information about the sequence of audio if it's a part of larger work",
                hierarchyInfo:
                  "Information about hierarchy if the audio is a part of a collection",
              },
              administrative: {
                ownershipInfo: "Information about ownership",
                rightsInfo: "Information about rights and restrictions",
                source: "Information about the source of the audio",
                preservationHistory:
                  "Information about preservation steps taken",
              },
              contextual: {
                recordingLocation: "Location where the recording was made",
                culturalContext: "Cultural context of the audio",
                historicalContext: "Historical context of the audio",
              },
              preservation: {
                preservationSteps: "Steps taken for preserving the audio",
                futurePreservationPlan:
                  "Any future plans for preserving the audio",
              },
              userDefined: userDefinedInput.value,
            },
            playbackControls: {
              note: noteInput.value,
              name: filenameWithoutExtension,
              velocity: 1.0,
              duration: document.getElementById("duration").value,
              isLoop: isLoop,
              loopGap: loopGap,
              loopBPM: loopBPM,
              playSpeed: 1.0,
              keyShift: 0,
            },
          };

          var audionalJsonString = JSON.stringify(audionalJson, null, 2);
          var audionalJsonBlob = new Blob([audionalJsonString], {
            type: "application/json",
          });
          var audionalJsonUrl = URL.createObjectURL(audionalJsonBlob);

          convertButton.classList.remove("flashing");
          convertButton.style.backgroundColor = "green";
          convertButton.innerText = "Audional JSON File Downloaded";
          document.getElementById("reminder").style.color = "grey";

          var dataStr =
            "data:text/json;charset=utf-8," +
            encodeURIComponent(audionalJsonString);
          var downloadAnchorNode = document.createElement("a");
          downloadAnchorNode.setAttribute("href", dataStr);
          downloadAnchorNode.setAttribute(
            "download",
            file.name.replace(/\.[^/.]+$/, "") + "_audional.json"
          );
          document.body.appendChild(downloadAnchorNode);
          downloadAnchorNode.click();
          downloadAnchorNode.remove();

          // After downloading the file, redirect the user to audionals.com
          window.location.href = "https://www.audionals.com";

          // Enable the inscribe button when audionalJson is ready
          audionalJson = 52; // Set audionalJson to your actual JSON data
          inscribeButton.disabled = false;

          // Open new window and set audionalJson in its context when button is clicked
          inscribeButton.addEventListener("click", function () {
            var newWindow = window.open("api_call.html");
            newWindow.audionalJson = audionalJson;
          });

          reader.onerror = function () {
            alert("Error reading file");
          };

          reader.readAsDataURL(file);
        };
      });
    </script>
  </body>
</html>
