<!DOCTYPE html><style>@keyframes flash{0%{background-color:var(--primary-color)}50%{background-color:#0f0}100%{background-color:var(--primary-color)}}@keyframes flashingYellow{0%{background-color:#999902}50%{background-color:#ff0}100%{background-color:#999902}}.clear-button.flashing{animation:flashingYellow .5s infinite}.channel{display:flex}.ordinal-loaded{border:2px solid #f7931a}#play,#stop{flex:1;width:50px;height:50px}.clear-button,.mute-button,.solo-button{flex:1;min-width:18px;max-width:18px}.letter{z-index:1;font-size:16px;position:relative;left:-5px;top:-3px;color:#000}#play{animation:flash 2s infinite ease-in-out}#play.selected,#stop.selected~#play{animation:none}#stop.selected~#play,.mute-button.selected,.solo-button.selected{background-color:var(--accent-color)}#play.selected .letter,#stop.selected~#play .letter,.mute-button.selected .letter,.solo-button.selected .letter,.step-button.selected .letter{color:#fff}.clear-button,.mute-button,.solo-button{aspect-ratio:1/1}.clear-button{background-color:#999902}.mute-button{background-color:#800}.solo-button{background-color:#b16921}.solo-button.selected{background-color:#ff8000}.step-button{position:relative;min-width:0;aspect-ratio:1/1;background-color:#555;color:#fff;max-width:20px;max-height:20px}.color-FF0000 .step-button.selected{background-color:red}.color-00FF00 .step-button.selected{background-color:#0F0}.color-0000FF .step-button.selected{background-color:#00F}.color-FFFF00 .step-button.selected{background-color:#FF0}.color-00FFFF .step-button.selected{background-color:#0FF}.color-FF00FF .step-button.selected{background-color:#F0F}.color-808080 .step-button.selected{background-color:grey}.color-FFFFFF .step-button.selected{background-color:#FFF}.color-FFA500 .step-button.selected{background-color:orange}.color-800080 .step-button.selected{background-color:purple}.color-008080 .step-button.selected{background-color:teal}.color-000080 .step-button.selected{background-color:navy}.color-800000 .step-button.selected{background-color:maroon}.color-008000 .step-button.selected{background-color:green}.color-FFC0CB .step-button.selected{background-color:pink}.color-D2691E .step-button.selected{background-color:#D2691E}.step-button:nth-child(4n+1):not(:nth-child(16n+1)){background-color:#add8e6}.step-button:nth-child(16n+1){background-color:#ff0}.step-button.selected,.step-button.selected:nth-child(16n+1),.step-button.selected:nth-child(4n+1):not(:nth-child(16n+1)){background-color:var(--accent-color)}.step-button.selected{background-color:var(--accent-color)}.step-button.playing{box-shadow:0 0 10px #969696 inset}.step-button.playing.selected{box-shadow:0 0 10px #960101 inset}.step-button.dimmed{opacity:.5}.load-sample-button{flex:1;overflow:auto;text-overflow:ellipsis;font-size:.8em;height:20px;max-width:15%;min-width:10%;padding:1px;font-weight:700}.load-sample-button:hover::after{position:absolute;top:100%;left:0;background:var(--primary-color);color:var(--main-bg-color);z-index:1}.color-FF0000 .color-FF0000 .step-button.selected{background-color:red}.color-00FF00 .color-FF0000 .step-button.selected{background-color:#0F0}.color-0000FF .color-FF0000 .step-button.selected{background-color:#00F}.color-FFFF00 .color-FF0000 .step-button.selected{background-color:#FF0}.color-00FFFF .color-FF0000 .step-button.selected{background-color:#0FF}.color-FF00FF .color-FF0000 .step-button.selected{background-color:#F0F}.color-808080 .color-FF0000 .step-button.selected{background-color:grey}.color-FFFFFF .color-FF0000 .step-button.selected{background-color:#FFF}.color-FFA500 .color-FF0000 .step-button.selected{background-color:orange}.color-800080 .color-FF0000 .step-button.selected{background-color:purple}.color-008080 .color-FF0000 .step-button.selected{background-color:teal}.color-000080 .color-FF0000 .step-button.selected{background-color:navy}.color-800000 .color-FF0000 .step-button.selected{background-color:maroon}.color-008000 .color-FF0000 .step-button.selected{background-color:green}.color-FFC0CB .color-FF0000 .step-button.selected{background-color:pink}.color-D2691E .color-FF0000 .step-button.selected{background-color:#D2691E}.button,h1 .button{border:none;background-color:var(--primary-color);cursor:pointer;box-shadow:var(--box-shadow-style);color:var(--main-bg-color);font-size:1em}.control-button{width:var(--control-button-dimension);height:var(--control-button-dimension);display:flex;align-items:center;justify-content:center;font-weight:700;margin:0;position:relative}.play-button,.stop-button{position:relative;width:30px;height:30px;font-size:14px;padding:5px}#play.selected{background-color:#0f0}.stop-button{background-color:var(--accent-color)}.button-label.stop{color:red}div[idModalContent] div{display:flex;align-items:center;justify-content:flex-start;margin-bottom:10px;cursor:pointer}div[idModalContent] div button{margin-right:10px;background-color:#f0f0f0;border:none;border-radius:50%;width:30px;height:30px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background-color .3s ease}div[idModalContent] div button:hover{background-color:#ddd}div[idModalContent] div a{text-decoration:none;display:flex;color:#000;transition:color .3s ease}div[idModalContent] div a:hover{color:#666}.dropdown:hover .dropbtn{background-color:#3e8e41}.action-button{border:none;color:#fff;text-align:center;text-decoration:none;display:inline-block;font-size:16px;cursor:pointer;border-radius:4px;transition:background-color .3s}.action-button:hover{background-color:#45a049}.tooltip{position:relative;display:inline-block;cursor:pointer}.tooltip .tooltiptext{visibility:hidden;max-width:150px;background-color:#333;color:#fff;text-align:center;border-radius:8px;position:absolute;z-index:1;bottom:calc(100% + 5px);left:50%;transform:translateX(-50%);opacity:.7;transition:opacity .3s;font-size:12px;pointer-events:none}.tooltip:hover .tooltiptext{visibility:visible;opacity:.7}.mode-switcher{display:flex;align-items:center;justify-content:center;margin-left:50px}.mode-switcher label{margin-right:10px}.mode-switcher input[type=checkbox]{appearance:none;width:40px;height:20px;background-color:#ccc;border-radius:10px;position:relative;cursor:pointer}.mode-switcher input[type=checkbox]:checked{background-color:#2196f3}.mode-switcher input[type=checkbox]::before{content:"";position:absolute;top:1px;left:1px;width:18px;height:18px;background-color:#fff;border-radius:50%;transition:transform .2s ease}.mode-switcher input[type=checkbox]:checked::before{transform:translateX(20px)}.custom-context-menu{position:absolute;background-color:#f9f9f9;border:1px solid #ccc;padding:5px;z-index:1000}body{background-color:var(--main-bg-color);color:var(--primary-color);font:normal normal normal 100%/1 var(--default-font)}#drum-machine{max-width:100%;margin:0 auto;padding:0;background-color:var(--secondary-bg-color);box-sizing:border-box}h1{text-align:center;display:flex;justify-content:space-between;align-items:center;position:relative}h3 .subtext{font-size:.8em;opacity:.7}h3:hover .subtext{font-size:1em;opacity:.5}.title{font-size:40px}.small-text,.smaller-text{font-size:20px}.larger-text{font-size:1.5em}.centered,.centered-text{display:block;text-align:center}.bright-orange{color:#f7931a}.drum-machine-container{width:95%;margin:0 auto;padding:20px}.steps-container{display:none}.drum-machine-container .steps-container{display:grid;grid-template-columns:repeat(64,minmax(10px,1fr));gap:0;overflow-x:auto}@media screen and (max-width:1280px){.drum-machine-container .steps-container{grid-template-columns:repeat(32,minmax(10px,1fr))}}@media screen and (max-width:1024px){.drum-machine-container .steps-container{grid-template-columns:repeat(16,minmax(10px,1fr))}}@media screen and (max-width:768px){.drum-machine-container .steps-container{grid-template-columns:repeat(16,minmax(10px,1fr))}}.controls-container{flex:1}.controls-container{margin:5px;border:1px solid #ccc;border-radius:5px;overflow:auto}*,::after,::before{box-sizing:border-box}.steps-container{display:none;grid-template-columns:repeat(64,minmax(10px,1fr));gap:0;overflow-x:auto}@media screen and (max-width:1280px){.steps-container{grid-template-columns:repeat(32,minmax(10px,1fr))}}@media screen and (max-width:1024px){.steps-container{grid-template-columns:repeat(16,minmax(10px,1fr))}}@media screen and (max-width:768px){.steps-container{grid-template-columns:repeat(16,minmax(10px,1fr))}}.channel-controls{margin-top:0}#sequence-lights{display:flex;flex-direction:row;justify-content:space-between;width:90%;margin-left:10%}.sequence-light{grid-column:span 1;height:15px;background-color:grey}.sequence-light.on{background-color:#adff2f}.quickplay-button-container{width:90%;margin:0 auto;display:flex;align-items:center;justify-content:center}.quick-play-button{width:30px;height:30px;padding:5px;margin:0 5px;display:flex;justify-content:center;align-items:center;background-color:#4CAF50;color:#fff;cursor:pointer}@media (max-width:600px){.quick-play-button{width:30px;height:30px;padding:3px}}.quick-play-button strong{display:block;font-weight:700}.quick-play-button.active{background-color:#32cd32}#next-sequence,#prev-sequence,button[for=mode-switcher]{font-size:12.5px;padding:5px 10px;font-weight:700}.loadSampleModalButton{position:fixed;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:9999}.loadSampleModalButton-content{background-color:#fff;padding:20px;border-radius:10px;width:50%;max-height:500px;overflow-y:auto}.loadSampleModalButton-text{color:#000;margin-bottom:10px}.loadSampleModalButton-input{margin-bottom:10px;width:100%;box-sizing:border-box}.loadSampleModalButton button{margin-top:10px;padding:10px 15px;border:none;border-radius:5px;color:#fff;cursor:pointer}.loadSampleModalButton button:hover{background-color:#f6ff00;color:#000}.channel-naming-modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background-color:#fff;padding:20px;border-radius:10px;z-index:1000}.channel-name-input{width:100%;margin-bottom:10px}.loadSampleModalButton-link{padding:10px;margin-top:10px;color:#fff;background-color:#b0f;border:none;border-radius:5px;cursor:pointer}.loadSampleModalButton-link:hover{background-color:#b0f}.loadButton{background-color:#28a745}.cancelButton{background-color:#dc3545}.searchButton{background-color:#b0f}.tooltip{position:relative;display:inline-block}.tooltip .tooltiptext{visibility:hidden;width:120px;background-color:#000;color:#fff;text-align:center;border-radius:6px;padding:5px 0;position:absolute;z-index:1;bottom:125%;left:100%;margin-left:-60px;opacity:0;transition:opacity .3s}.tooltip .tooltiptext::after{content:"";position:absolute;top:100%;left:50%;margin-left:-5px;border-width:5px;border-style:solid;border-color:#000 transparent transparent transparent}.tooltip:hover .tooltiptext{visibility:visible;opacity:1}.load-popup{display:none;position:absolute;bottom:30px;right:0;border:1px solid #aaa;background-color:#f9f9f9;z-index:1000}.load-popup button{display:block;padding:10px;border:none;width:50%;text-align:left;cursor:pointer;background-color:#f9f9f9}.load-popup button:hover{background-color:#ddd}.modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#000;background-color:rgba(0,0,0,.4)}.modal-content{background-color:#fefefe;margin:15% auto;padding:20px;border:1px solid #888;width:80%}.close-button{color:#aaa;float:right;font-size:28px;font-weight:700}.close-button:focus,.close-button:hover{color:#000;text-decoration:none;cursor:pointer}#new-load-button,#save-button{margin-left:2px;right:0}#new-load-button{margin-left:2px;right:0;background-color:#fff;color:#000;animation:smooth-wave 4s linear infinite}@keyframes smooth-wave{0%{background-color:#fff;color:#000}25%{background-color:#fd6f6f;color:#000}50%{background-color:#fff;color:#000}75%{background-color:#ff6f6f;color:#000}100%{background-color:#fff;color:#000}}.copy-button{background-color:#2196F3}.copy-button:hover{background-color:#0b7dda}.paste-button{background-color:#FFC107}.paste-button:hover{background-color:#ffb300}:root{--scale-factor:1vw;--main-bg-color:#000;--secondary-bg-color:#333;--primary-color:#fff;--accent-color:#f00;--button-dimension:5vw;--control-button-dimension:18px;--box-shadow-style:0 0 1vw var(--main-bg-color)inset;--default-font:Arial,sans-serif}.channel{width:100%}</style><meta content="width=device-width,initial-scale=1"name=viewport><div class=drum-machine-container><div id=drum-machine><h1><span class=button-label>Play</span><div class="tooltip button button-round"><div class="button play-button"id=play></div><span class=tooltiptext>Start the sequence.</span></div><span class="button-label stop">Stop</span><div class="tooltip button button-round"><div class="button stop-button"id=stop></div><span class=tooltiptext>Stop the sequence.</span></div><div class="tooltip bpm-container">BPM: <input id=bpm-slider type=range max=180 min=60 step=1 title="Adjust the Beats Per Minute"value=105><div class=bpm-display id=bpm-display>105</div><span class=tooltiptext>Drag to adjust the BPM (Beats Per Minute) of the sequence.</span></div><span class=title>Audional Sequencer<br><span class=bright-orange>₿</span>itcoin<span class=bright-orange>₿</span>eats<span class="bright-orange small-text,">₿</span><span class=small-text>eta</span></span></h1><div class=utility-buttons><button class=tooltip id=save-button>Save <span class=tooltiptext>This button will save your sequence into JSON file for download so you can recall it later on.</span></button> <input id=save-file-input type=file style=display:none> <button class=tooltip id=new-load-button>Load <span class=tooltiptext>This button will load your audional composition JSON files, even while the sequencer is playing live.</span></button><div class=load-popup id=loadOptions><button id=loadJson>Load from Json file</button></div><input id=load-file-input type=file style=display:none accept=.json> <button class="tooltip action-button copy-button"id=copy-sequence-settings>Copy <span class=tooltiptext>Copy Sequence Steps</span></button> <button class="tooltip action-button paste-button"id=paste-button>Paste <span class=tooltiptext>Paste the sequence settings from clipboard.</span></button><label class=tooltip for=project-name>Project Name <span class=tooltiptext>Enter the project name</span></label><input id=project-name class=project-name placeholder="Enter project name"></div><div class=subtext-container><p class="centered-text subtext">Raw On-chain <span class=bright-orange>₿</span>itcoin Audionals: playing live, directly from the <span>₿</span>lockchain!</div><main id=app role=main><div class=channel-template style=display:none><div class=channel><button class="tooltip load-sample-button"title="Load New Audional">Load New Audional <span class=tooltiptext>Use this button to load a new audional sample into the current channel.</span></button> <button class="tooltip control-button open-audio-trimmer"style=background-color:#00f;font-weight:700><span class=letter>T</span> <span class=tooltiptext>Open Audio Trimmer for this channel.</span></button> <button class="tooltip control-button clear-button"><span class=letter>C</span> <span class=tooltiptext>Clear the current channel's sequence.</span><div class=clear-confirm style=display:none;position:absolute;background-color:rgba(0,0,0,.7);color:#fff;padding:5px;border-radius:3px;z-index:10>Click again to confirm clear</div></button> <button class="tooltip control-button mute-button"><span class=letter>M</span> <span class=tooltiptext>Mute or unmute the current channel.</span></button> <button class="tooltip control-button solo-button"><span class=letter>S</span> <span class=tooltiptext>Solo the current channel.</span></button><div class=steps-container></div></div></div></div></div><div class=quickplay-button-container><button class=tooltip id=prev-sequence>Previous Sequence <span class=tooltiptext>Go to the previous sequence</span></button> <span class=tooltip id=current-sequence-display>Sequence 0 <span class=tooltiptext>Currently displayed sequence</span> </span><button class=tooltip id=next-sequence>Next Sequence <span class=tooltiptext>Go to the next sequence</span></button><label class=tooltip for=continuous-play>Continuous Play <span class=tooltiptext>Toggle continuous play mode</span></label><input id=continuous-play type=checkbox checked class=tooltip></div><div class=modal id=audio-trimmer-modal hidden><div class=modal-content><span class=close-button>×</span><div id=audio-trimmer-container></div></div></div>

    <script src="allInOneSequencer.js"></script>
<!-- <script>const BASE_ORDINALS_URL="https://ordinals.com/content/";function isValidOrdinalsUrl(n){return new RegExp(`^${BASE_ORDINALS_URL}[a-f0-9]{64}i\\d+$`).test(n)}function formatId(n){return new RegExp("^[a-f0-9]{64}i\\d+$").test(n)?n:(console.error("Invalid ID format:",n),null)}function formatURL(n){if(n.startsWith(BASE_ORDINALS_URL))return n;const r=new RegExp(`^${BASE_ORDINALS_URL}${BASE_ORDINALS_URL}(.+)`),t=n.match(r);return t&&t[1]?BASE_ORDINALS_URL+t[1]:n.match(/^[a-f0-9]{64}i\d+$/)?BASE_ORDINALS_URL+n:n}function toFullUrl(n){return n?BASE_ORDINALS_URL+formatId(n):null}function extractIdFromUrl(n){return isValidOrdinalsUrl(n)?n.replace(BASE_ORDINALS_URL,""):(console.error("Invalid Ordinals URL:",n),null)}</script>
<script>class UnifiedSequencerSettings{constructor(){this.observers=[],this.settings={masterSettings:{projectName:"New Audx Project",projectBPM:120,currentSequence:0,channelURLs:new Array(16).fill(""),trimSettings:Array.from({length:16},(()=>({start:.01,end:100,length:0}))),projectChannelNames:new Array(16).fill(""),projectSequences:this.initializeSequences(16,16,64)}},this.checkSettings=this.checkSettings.bind(this),this.clearMasterSettings=this.clearMasterSettings.bind(this)}exportSettings(){console.log("exportSettings entered");const e=JSON.parse(JSON.stringify(this.settings.masterSettings));for(let t in e.projectSequences){const n=e.projectSequences[t];for(let e in n){const t=n[e],s=[];t.steps.forEach(((e,t)=>{e&&s.push(t+1)})),t.steps=s}}const t=JSON.stringify(e);return console.log("[exportSettings] Exported Settings:",t),t}isValidIndex(e){return console.log("isValidIndex entered"),e>=0&&e<16}loadSettings(e){console.log("[internalPresetDebug] loadSettings entered");try{console.log("[internalPresetDebug] Received JSON Settings:",e);const t="string"==typeof e?JSON.parse(e):e;if(console.log("[internalPresetDebug] Parsed Settings:",t),this.settings.masterSettings.channelURLs=t.channelURLs?t.channelURLs.map((e=>formatURL(e))):[],this.settings.masterSettings.projectName=t.projectName,this.settings.masterSettings.projectBPM=t.projectBPM,this.settings.masterSettings.trimSettings=t.trimSettings,this.settings.masterSettings.projectChannelNames=t.projectChannelNames,console.log("[internalPresetDebug] Updated masterSettings with full URLs:",this.settings.masterSettings),t.projectSequences)for(let e in t.projectSequences){let n=t.projectSequences[e];for(let e in n){let t=n[e],s=new Array(64).fill(!1);t.steps.forEach((e=>{e>=1&&e<=64&&(s[e-1]=!0)})),t.steps=s}}this.settings.masterSettings=t,console.log("[internalPresetDebug] Master settings after update:",this.settings.masterSettings),this.updateAllLoadSampleButtonTexts(),this.notifyObservers()}catch(e){console.error("[internalPresetDebug] Error loading settings:",e)}}addChannelURL(e,t){e>=0&&e<this.settings.masterSettings.channelURLs.length?(console.log(`[addChannelURL] Adding URL to channel ${e}: ${t}`),this.settings.masterSettings.channelURLs[e]=t,this.notifyObservers()):console.error(`[addChannelURL] Invalid channel index: ${e}`)}getChannelURL(e){return e>=0&&e<this.settings.masterSettings.channelURLs.length?(console.log(`[getChannelURL] Retrieving URL from channel ${e}: ${this.settings.masterSettings.channelURLs[e]}`),this.settings.masterSettings.channelURLs[e]):(console.error(`[getChannelURL] Invalid channel index: ${e}`),null)}getprojectUrlforChannel(e){return console.log("getprojectUrlforChannel entered"),this.settings.masterSettings.channelURLs[e]}setChannelURLs(e){console.log("setProjectURLs entered"),this.settings.masterSettings.channelURLs=e,console.log("[setChannelURLs] Channel URLs set:",e),this.updateAllLoadSampleButtonTexts()}setProjectName(e){console.log("setProjectName entered"),this.settings.masterSettings.projectName=e,console.log(`[setProjectName] Project name set to: ${e}`)}clearMasterSettings(){console.log("[clearMasterSettings] Current masterSettings before clearing:",this.settings.masterSettings),this.settings.masterSettings={projectName:"",projectBPM:120,currentSequence:0,channelURLs:new Array(16).fill(""),trimSettings:Array.from({length:16},(()=>({start:.01,end:100,length:0}))),projectChannelNames:new Array(16).fill(""),projectSequences:this.initializeSequences(16,16,64)},console.log("[clearMasterSettings] Master settings cleared.")}initializeSequences(e,t,n){console.log("initializeSequences entered",e,t,n);let s={};for(let r=0;r<e;r++)s[`Sequence${r}`]=this.initializeChannels(t,n);return s}initializeChannels(e,t){console.log("initializeChannels entered",e,t);let n={};for(let s=0;s<e;s++)n[`ch${s}`]={steps:new Array(t).fill(!1),mute:!1,url:""};return n}initializeTrimSettings(e){return console.log("initializeTrimSettings entered"),channelIndex<1&&console.log("initializeTrimSettings",e),Array.from({length:e},(()=>({start:0,end:100,length:0})))}updateTrimSettingsUI(e){console.log("Trim settings UI entered and updated:",e),e.forEach(((e,t)=>{const n=document.getElementById(`start-slider-${t}`),s=document.getElementById(`end-slider-${t}`);n&&s&&(n.value=e.start,s.value=e.end)}))}addObserver(e){console.log("addObserver",e),this.observers.push(e)}notifyObservers(){console.log("notifyObservers"),this.observers.forEach((e=>e(this.settings)))}setTrimSettings(e,t,n){if(console.log("setTrimSettings entered"),e<1&&console.log("setTrimSettings",e,t,n),this.isValidIndex(e)){const s=this.settings.masterSettings.trimSettings[e];s?Object.assign(s,{start:t,end:n}):console.error(`Trim settings not found for channel index: ${e}`)}else console.error(`Invalid channel index: ${e}`)}getTrimSettings(e){console.log("getTrimSettings entered"),e<1&&console.log("getTrimSettings",e);return this.settings.masterSettings.trimSettings[e]||{start:.01,end:100}}updateTrimSettingsUI(e){console.log("updateTrimSettingsUI entered",e),console.log("Trim settings UI updated:",e),e.forEach(((e,t)=>{const n=document.getElementById(`start-slider-${t}`),s=document.getElementById(`end-slider-${t}`);n&&s&&(n.value=e.start,s.value=e.end)}))}setProjectName(e,t){console.log("setProjectName entered"),e<1&&console.log("setProjectName",e,t),this.settings.masterSettings.projectName[e]=t,this.notifyObservers()}setCurrentSequence(e){console.log("[SeqDebug] setCurrentSequence entered with: ",e),this.settings.masterSettings.currentSequence=e,console.log(`[SeqDebug] [setCurrentSequence] currentSequence set to: ${e}`),console.log(`[SeqDebug] [setCurrentSequence] Object currentSequence set to: ${this.settings.masterSettings.currentSequence}`)}getCurrentSequence(){return console.log("getCurrentSequence entered"),this.settings.masterSettings.currentSequence}getSequenceSettings(e){console.log("getSequenceSettings entered");const t=`Sequence${e}`;return this.settings.masterSettings.projectSequences[t]}setSequenceSettings(e,t){console.log("setSequenceSettings entered");const n=`Sequence${e}`;this.settings.masterSettings.projectSequences[n]=t}getSettings(e){if(console.log("getSettings entered",e),"masterSettings"===e)return console.log("[getSettings] Retrieved all masterSettings:",this.settings.masterSettings),this.settings.masterSettings;if(e){const t=this.settings.masterSettings[e];return console.log(`[getSettings] Retrieved setting for key '${e}':`,t),t}return console.log("[getSettings] Retrieved all settings:",this.settings),this.settings}checkSettings(){return console.log("checkSettings entered"),console.log("[checkSettings] Current masterSettings:",this.settings.masterSettings),this.settings.masterSettings}updateProjectSequencesUI(){console.log("updateProjectSequencesUI entered"),channelIndex<1&&console.log("updateProjectSequencesUI");this.getSettings("projectSequences").forEach(((e,t)=>{updateSequenceUI(t,e)}))}updateStepState(e,t,n,s){console.log("updateStepState entered"),t<1&&console.log(`[updateStepState] Called with Sequence: ${e}, Channel: ${t}, Step: ${n}, State: ${s}`);const r=this.settings.masterSettings.projectSequences[`Sequence${e}`],o=r&&r[`ch${t}`];o&&n<o.steps.length?o.steps[n]=s:console.error("Invalid sequence, channel, or step index in updateStepState")}getStepState(e,t,n){console.log("getStepState entered"),t<1&&console.log(`[getStepState] Called with Sequence: ${e}, Channel: ${t}, Step: ${n}`);const s=this.settings.masterSettings.projectSequences[`Sequence${e}`],r=s&&s[`ch${t}`];return r&&n<r.steps.length?r.steps[n]:(console.error("Invalid sequence, channel, or step index in getStepState"),null)}updateSetting(e,t,n=null){console.log("updateSetting entered"),n<1&&console.log(`[updateSetting] Called with key: ${e}, value: ${t}, channelIndex: ${n}`),null!==n&&Array.isArray(this.settings.masterSettings[e])?this.settings.masterSettings[e][n]=t:e in this.settings.masterSettings?this.settings.masterSettings[e]=t:console.error(`Setting ${e} does not exist in masterSettings`)}updateSampleDuration(e,t){console.log("updateSampleDuration entered"),t<1&&console.log(`[updateSampleDuration] Called with duration: ${e}, channelIndex: ${t}`),this.isValidIndex(t)?this.settings.masterSettings.trimSettings[t].length=e:console.error(`Invalid channel index: ${t}`)}getBPM(){return this.settings.masterSettings.projectBPM}setBPM(e){this.settings.masterSettings.projectBPM=e}setProjectChannelName(e,t){console.log("setProjectChannelName entered"),this.isValidIndex(e)?this.settings.masterSettings.projectChannelNames[e]!==t&&(this.settings.masterSettings.projectChannelNames[e]=t,console.log(`[setChannelName] Channel ${e} name set to: ${t}`),this.notifyObservers()):console.error(`[setChannelName] Invalid channel index: ${e}`)}setProjectSequences(e){console.log("setProjectSequences entered"),this.settings.masterSettings.projectSequences=e,console.log("[setProjectSequences] Project sequences set:",e),console.log("[setProjectSequences] currentSequence set to:",this.settings.masterSettings.currentSequence)}ensureArrayLength(e,t,n){for(console.log("ensureArrayLength entered");e.length<t;)e.push(n)}updateAllLoadSampleButtonTexts(){console.log("updateAllLoadSampleButtonTexts entered");document.querySelectorAll(".channel").forEach(((e,t)=>{const n=e.querySelector(".load-sample-button");n&&(()=>{this.updateLoadSampleButtonText(t,n)})()}))}updateLoadSampleButtonText(e,t){console.log("updateLoadSampleButtonText entered");let n="Load New Audional";const s=this.settings.masterSettings.projectChannelNames[e],r=this.settings.masterSettings.channelURLs[e];if(s)n=s;else if(r){const e=r.split("/");n=e[e.length-1]}t.textContent=n}updateProjectNameUI(e){console.log("Project name UI entered and updated:",e);const t=document.getElementById("project-name");t&&(t.value=e||"AUDX Project",console.log("Project name UI updated:",e))}updateBPMUI(e){const t=document.getElementById("bpm-slider"),n=document.getElementById("bpm-display");t&&n&&(t.value=e,n.textContent=e,console.log("BPM UI updated:",e))}updateProjectURLsUI(e){console.log("Project URLs UI entered and updated:",e),e.forEach(((e,t)=>{const n=document.getElementById(`url-input-${t}`);n&&(n.value=e)}))}updateProjectChannelNamesUI(e){console.log("Project URL names UI entered and updated:",e),e.forEach(((e,t)=>{const n=document.getElementById(`url-name-${t}`);n&&(n.textContent=e)}))}ensureArrayLength(e,t){for(;e.length<t;)e.push(this.getDefaultArrayElement())}getDefaultArrayElement(){return{start:.01,end:100,length:0}}}window.unifiedSequencerSettings=new UnifiedSequencerSettings;</script>
<script>let currentTrimmerInstance=null,currentTrimmerChannelIndex=null;function updateAudioTrimmerWithBufferHelper(e,r){if(console.log("updateAudioTrimmerWithBufferHelper entered"),audioBuffers.has(e)){updateAudioTrimmerWithBuffer(audioBuffers.get(e),r)}else console.error(`Audio buffer not found for URL: ${e}`)}function updateAudioTrimmerWithBuffer(e){console.log("updateAudioTrimmerWithBuffer entered"),currentTrimmerInstance&&(currentTrimmerInstance.setAudioBuffer(e),currentTrimmerInstance.drawWaveform(),console.log(" updateDimmedAreas method called from updateaudioTrimmerWithBuffer"),currentTrimmerInstance.updateSliderValues(),currentTrimmerInstance.updateDimmedAreas())}function playTrimmedAudioForChannel(e){console.log("playTrimmedAudioForChannel entered"),currentTrimmerInstance&&currentTrimmerChannelIndex===e?currentTrimmerInstance.playTrimmedAudio():console.error("No active trimmer instance for the channel or channel index mismatch")}function stopAudioForChannel(e){currentTrimmerInstance&&currentTrimmerInstance.channelIndex===e?currentTrimmerInstance.stopAudio():console.error("No active trimmer instance for the channel or channel index mismatch")}document.addEventListener("DOMContentLoaded",(function(){}));</script>
<script>class AudioTrimmer{constructor(t){console.log("[Class Functions] constructor",{channelIndex:t}),this.channelIndex=t,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioBuffer=null,this.isPlaying=!1,this.isLooping=!1,this.initializeSliderTrack(t);const e=getTrimSettings(this.channelIndex);console.log("getSettings read into trimSettings in AudioTrimmer class constructor",e),this.startSliderValue=e.startSliderValue,this.endSliderValue=e.endSliderValue,console.log("startSliderValue and endSliderValue in AudioTrimmer class constructor",this.startSliderValue,this.endSliderValue),this.displayTimeout=null}initializeSliderTrack(){this.sliderTrack=document.querySelector(".slider-track"),this.sliderTrack||console.error("Slider track not found")}updateTrimmedSampleDuration(){const t=this.startSliderValue,e=this.endSliderValue;this.trimmedSampleDuration=Math.max(0,e-t),this.debounceDisplayValues()}getStartSliderValue(){return this.startSliderValue}getEndSliderValue(){return this.endSliderValue}sliderValueToTimecode(t,e){return t/100*e}debounceDisplayValues(){this.displayTimeout&&clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout((()=>this.displayValues()),300)}displayValues(){console.log("Start Slider Value:",this.startSliderValue),console.log("End Slider Value:",this.endSliderValue),console.log("Trimmed Sample Duration:",this.trimmedSampleDuration)}setAudioBuffer(t){console.log("[Class Functions] setAudioBuffer",{audioBuffer:t}),this.audioBuffer=t,this.drawWaveform(),console.log(" updateDimmedAreas method called from setAudioBuffer"),this.updateDimmedAreas(),this.updateSliderValues()}drawWaveform(){if(console.log("[Class Functions] drawWaveform"),!this.audioBuffer)return void console.log("[Class Functions] drawWaveform - No audio buffer");const t=this.waveformCanvas.width,e=this.waveformCanvas.height,i=this.audioBuffer.getChannelData(0),s=Math.ceil(i.length/t),o=e/2;this.ctx.clearRect(0,0,t,e),this.ctx.beginPath();for(let e=0;e<t;e++){const{min:t,max:a}=this.getMinMax(i,e*s,s);this.ctx.moveTo(e,o*(1+t)),this.ctx.lineTo(e,o*(1+a))}this.ctx.stroke()}async initialize(){console.log("[Class Functions] initialize");let t=!0;["ordinalIdInput","loadSampleButton","waveformCanvas","playbackCanvas","trimmerPlayButton","trimmerStopButton","loopButton","startDimmed","endDimmed","startSlider","endSlider"].forEach((e=>{this[e]=document.getElementById(e),this[e]||(console.error(`[Class Functions] initialize - Element not found: ${e}`),t=!1)})),t?(this.ctx=this.waveformCanvas.getContext("2d"),this.addEventListeners(),console.log(" updateDimmedAreas method called from initialize"),this.updateDimmedAreas(),this.updateSliderValues()):(console.log("[Class Functions] initialize - Waiting for elements to be available"),setTimeout((()=>this.initialize()),500));const e=getTrimSettings(this.channelIndex);this.startSlider.value=e.startSliderValue,this.endSlider.value=e.endSliderValue,this.isLooping=e.isLooping,this.updateLoopButtonState(),this.updateDimmedAreas(),this.updateSliderValues(),this.playbackCtx=this.playbackCanvas.getContext("2d"),this.playbackCtx.fillStyle="red"}updateSliderValues(){const t=this.startSliderValue/100*this.sliderTrack.offsetWidth,e=this.endSliderValue/100*this.sliderTrack.offsetWidth;this.startSlider.style.left=`${t}px`,this.endSlider.style.left=`${e}px`,this.updateDimmedAreas(),console.log("updateDimmedAreas method called from updateSliderValues"),this.updateTrimmedSampleDuration(),this.debounceDisplayValues()}updateDimmedAreas(){console.log("[Class Functions] updateDimmedAreas function entered into");const t=this.startSliderValue,e=this.endSliderValue,i=`${t}%`,s=100-e+"%";this.startDimmed.style.width=i,this.startDimmed.style.left="0",this.endDimmed.style.width=s,this.endDimmed.style.left=`${e}%`}addEventListeners(){console.log("[Class Functions] addEventListeners"),this.boundPlayTrimmedAudio=this.playTrimmedAudio.bind(this),this.boundStopAudio=this.stopAudio.bind(this),this.trimmerPlayButton.removeEventListener("click",this.boundPlayTrimmedAudio),this.trimmerStopButton.removeEventListener("click",this.boundStopAudio),this.trimmerPlayButton.addEventListener("click",this.boundPlayTrimmedAudio),this.trimmerStopButton.addEventListener("click",this.boundStopAudio),this.loopButton.addEventListener("click",this.toggleLoop.bind(this));const t=(t,e)=>{const i=e?this.startSlider:this.endSlider;if(console.log("[Slider Mouse Down] Slider: "+(e?"Start":"End")),!i)return void console.error("Slider element is undefined");const s=t.clientX-i.getBoundingClientRect().left;document.onmousemove=t=>{if(!this.sliderTrack)return void console.error("Slider track is undefined");let o=t.clientX-s-this.sliderTrack.getBoundingClientRect().left;if(o=Math.max(0,Math.min(o,this.sliderTrack.offsetWidth-i.offsetWidth)),e){const t=this.endSlider.getBoundingClientRect().left-this.sliderTrack.getBoundingClientRect().left;o=Math.min(o,t)}else{const t=this.startSlider.getBoundingClientRect().right-this.sliderTrack.getBoundingClientRect().left;o=Math.max(o,t)}i.style.left=`${o}px`;const a=o/this.sliderTrack.offsetWidth*100;e?this.startSliderValue=a:this.endSliderValue=a;let n=unifiedSequencerSettings.settings.masterSettings.trimSettings;n[this.channelIndex]={...n[this.channelIndex],startSliderValue:this.startSliderValue,endSliderValue:this.endSliderValue},updateTrimSettingsUI(n),this.updateSliderValues()},document.onmouseup=()=>{document.onmousemove=document.onmouseup=null}};this.startSlider.addEventListener("mousedown",(e=>t(e,!0))),this.endSlider.addEventListener("mousedown",(e=>t(e,!1)))}async loadSample(){if(console.log("[Class Functions] loadSample"),this.ordinalIdInput.value)try{this.audioBuffer=await fetchAudio(`https://ordinals.com/content/${this.ordinalIdInput.value}`),this.trimSettings=getTrimSettings(this.channelIndex),this.drawWaveform(),console.log(" updateDimmedAreas method called from loadSample"),this.updateSliderValues(),this.updateDimmedAreas()}catch(t){console.error("Error loading audio:",t)}}getMinMax(t,e,i){let s=1,o=-1;for(let a=0;a<i;a++){const i=t[e+a];i<s&&(s=i),i>o&&(o=i)}return{min:s,max:o}}getIsLooping(){return this.isLooping}setIsLooping(t){this.isLooping=t,this.updateLoopButtonState()}updateLoopButtonState(){console.log(`[updateLoopButtonState] isLooping: ${this.isLooping}`),this.loopButton&&(this.isLooping?(this.loopButton.classList.add("on"),this.loopButton.classList.remove("off")):(this.loopButton.classList.add("off"),this.loopButton.classList.remove("on")))}playTrimmedAudio(){if(console.log("[playTrimmedAudio] [Class Functions] playTrimmedAudio"),this.isPlaying)return void console.log("[playTrimmedAudio] Audio is already playing, not starting new playback");if(!this.audioBuffer)return void console.error("[playTrimmedAudio] No audio buffer loaded");this.isPlaying=!0,console.log("[playTrimmedAudio] isPlaying set to true, starting new playback");const t=this.sliderValueToTimecode(this.startSliderValue,this.audioBuffer.duration);this.startTime=this.audioContext.currentTime-t;const e=this.sliderValueToTimecode(this.startSliderValue,this.audioBuffer.duration),i=this.sliderValueToTimecode(this.endSliderValue,this.audioBuffer.duration);this.sourceNode&&this.sourceNode.disconnect(),this.sourceNode=this.audioContext.createBufferSource(),this.sourceNode.buffer=this.audioBuffer,this.sourceNode.connect(this.audioContext.destination),this.sourceNode.loop=this.isLooping,this.isLooping&&(this.sourceNode.loopStart=e,this.sourceNode.loopEnd=i),this.sourceNode.start(0,e,i-e),console.log("[playTrimmedAudio] Playback started"),this.animatePlayback(),this.sourceNode.onended=()=>{this.isPlaying=!1,this.isLooping?this.playTrimmedAudio():(console.log("[playTrimmedAudio] Playback ended, isPlaying set to false"),this.animationFrameRequest&&cancelAnimationFrame(this.animationFrameRequest))}}stopAudio(){console.log("[Class Functions] stopAudio"),this.setIsLooping(!1),this.isPlaying&&this.sourceNode&&(this.sourceNode.stop(),this.sourceNode.disconnect(),this.sourceNode=null,this.isPlaying=!1),this.animationFrameRequest&&cancelAnimationFrame(this.animationFrameRequest)}toggleLoop(){console.log("[Class Functions] toggleLoop"),this.isLooping=!this.isLooping,this.updateLoopButtonState(),this.isPlaying&&this.playTrimmedAudio()}getCurrentPlaybackPosition(){if(!this.isPlaying)return 0;const t=this.sliderValueToTimecode(this.startSliderValue,this.audioBuffer.duration);return(this.audioContext.currentTime-this.startTime)%this.audioBuffer.duration+t}updatePlaybackCanvas(){const t=this.audioContext.currentTime-this.startTime,e=this.sliderValueToTimecode(this.startSliderValue,this.audioBuffer.duration),i=this.sliderValueToTimecode(this.endSliderValue,this.audioBuffer.duration)-e,s=(t-e)%i;if(s<0||s>i)return;const o=this.playbackCanvas.width,a=this.playbackCanvas.height,n=this.startSliderValue/100*o,l=n+s/i*(this.endSliderValue/100*o-n);this.playbackCtx.clearRect(0,0,o,a),this.playbackCtx.beginPath(),this.playbackCtx.moveTo(l,0),this.playbackCtx.lineTo(l,a),this.playbackCtx.strokeStyle="#FF0000",this.playbackCtx.lineWidth=2,this.playbackCtx.stroke()}animatePlayback(){this.isPlaying?(console.log("[animatePlayback] Animation frame requested."),this.updatePlaybackCanvas(),this.animationFrameRequest=requestAnimationFrame((()=>this.animatePlayback()))):console.log("[animatePlayback] Animation stopped. 'isPlaying' is false.")}}</script>
<script>function getChannelURL(e){return cons,window.unifiedSequencerSettings.channelURLs(e)}function updateTrimSettingsUI(e){console.log("debugGlobalObjectToUI - entered"),console.log("{debugGlobalObjectToUI} updateTrimSettingsUI: updating with trimSettings",e),console.log("Trim settings UI updated:",e),e.forEach(((e,t)=>{const n=document.getElementById(`start-slider-${t}`),o=document.getElementById(`end-slider-${t}`);n&&o&&(n.value=e.startSliderValue,o.value=e.endSliderValue)}))}function updateProjectChannelNamesUI(e){console.log("debugGlobalObjectToUI - entered"),console.log("{debugGlobalObjectToUI} updateProjectChannelNamesUI: updating with URL names",e),console.log("Project URL names UI updated:",e),e.forEach(((e,t)=>{const n=document.getElementById(`url-name-${t}`);n&&(n.textContent=e)}))}function updateBPMUI(e){console.log("debugGlobalObjectToUI - entered");const t=document.getElementById("bpm-slider"),n=document.getElementById("bpm-display");t&&n&&(t.value=e,n.textContent=e)}function updateProjectNameUI(e){console.log("debugGlobalObjectToUI - entered");const t=document.getElementById("project-name");t&&(t.value=e)}function updateSpecificStepUI(e,t,n){console.log("debugGlobalObjectToUI - entered");const o=`Sequence${e}-ch${t}-step-${n}`;console.log(`Looking for step button with ID: ${o}`);const c=document.getElementById(o);if(c){let s=window.unifiedSequencerSettings.getStepState(e,t,n);console.log(`[updateSpecificStepUI] Step button found: Sequence ${e}, Channel ${t}, Step ${n}, Current State: ${s}`),s?(c.classList.add("selected"),console.log(`[updateSpecificStepUI] Added 'selected' class to step button with ID: ${o}`)):(c.classList.remove("selected"),console.log(`[updateSpecificStepUI] Removed 'selected' class from step button with ID: ${o}`))}else console.error(`Step button not found for the given IDs: ${o}`)}function getProjectSequences(){console.log("debugGlobalObjectToUI - entered");window.unifiedSequencerSettings;return window.unifiedSequencerSettings.getSettings("projectSequences")}function setGlobalProjectURLs(e){console.log("debugGlobalObjectToUI - entered"),window.unifiedSequencerSettings.setProjectURLs(e),console.log("[setGlobalProjectURLs] Project URLs updated:",e)}function setTrimSettings(e,t,n){"number"==typeof t&&"number"==typeof n?(window.unifiedSequencerSettings.setTrimSettings(e,t,n),console.log(`[setGlobalTrimSettings] Trim settings updated for channel ${e}: Start Slider Value = ${t}, End Slider Value = ${n}`)):console.error("Invalid trim settings values")}function updateProjectSequencesUI(e){console.log("debugGlobalObjectToUI - entered"),console.log("{debugGlobalObjectToUI} [updateProjectSequencesUI] updateProjectSequencesUI: updating with sequences",e),console.log(`[updateProjectSequencesUI] Total sequences to process: ${Object.keys(e).length}`),Object.keys(e).forEach((t=>{const n=e[t];console.log(`[updateProjectSequencesUI] Processing sequence: ${t}`),Object.keys(n).forEach((e=>{const o=n[e].steps;Array.isArray(o)?o.forEach(((n,o)=>{const c=`${t}-${e}-step-${o}`,s=document.getElementById(c);s&&(!0===n?s.classList.contains("selected")||s.classList.add("selected"):s.classList.contains("selected")&&(console.log(`[updateProjectSequencesUI] Removing 'selected' class from stepControl: ${c}`),s.classList.remove("selected")))})):console.log(`[updateProjectSequencesUI] Steps data for channel ${e} in sequence ${t} is not an array`)}))}))}function getTrimSettings(e){return console.log("debugGlobalObjectToUI - entered"),window.unifiedSequencerSettings.getTrimSettings(e)}document.addEventListener("DOMContentLoaded",(()=>{for(let e=0;e<16;e++)for(let t=0;t<16;t++){let n=document.querySelector(`#channel-${t}-steps-container`);n||(n=document.createElement("div"),n.id=`channel-${t}-steps-container`,n.classList.add("steps-container"),document.body.appendChild(n)),n.innerHTML="";for(let o=0;o<64;o++){const c=document.createElement("button");c.classList.add("step-button"),c.id=`Sequence${e}-ch${t}-step-${o}`,c.addEventListener("click",(()=>{let n=window.unifiedSequencerSettings.getStepState(e,t,o);console.log(`[updateSpecificStepUI] [getStepState applied] Step button clicked: Sequence ${e}, Channel ${t}, Step ${o}, Current State: ${n}`),window.unifiedSequencerSettings.updateStepState(e,t,o,!n),console.log(`[updateSpecificStepUI] Step button clicked: Sequence ${e}, Channel ${t}, Step ${o}, New State: ${!n}`),updateSpecificStepUI(e,t,o)})),n.appendChild(c)}}}));</script>
<script>const mainContainer=document.getElementById("app"),channelTemplateContainer=document.querySelector(".channel-template"),channelTemplate=channelTemplateContainer.querySelector(".channel"),quickPlayButtons=[];let currentActiveIndex=null;const quickPlayContainer=document.createElement("div");function setActiveSequence(e){null!==currentActiveIndex&&currentActiveIndex!==e&&(console.log(`Deactivating previously active sequence ${currentActiveIndex}`),quickPlayButtons[currentActiveIndex].classList.add("inactive")),quickPlayButtons[e].classList.remove("inactive"),quickPlayButtons.forEach((t=>{t!==quickPlayButtons[e]&&t.classList.add("inactive")})),currentActiveIndex=e}function updateActiveQuickPlayButton(){quickPlayButtons.forEach((e=>{e.classList.remove("active")}));quickPlayButtons[currentSequence].classList.add("active")}function insertQuickPlayButtons(){const e=document.getElementById("continuous-play"),t=document.getElementById("quick-play-button");if(e&&t)for(let n=0;n<16;n++){const c=createQuickPlayButton(n);e.parentNode.insertBefore(c,t)}else console.log("QUICKPLAY BUTTONS TEMPORARILY REMOVED UNTIL THEY CAN BE FIXED")}function loadAndDisplaySequence(e){currentSequence=e,console.log(`[loadAndDisplaySequence] currentSequence updated to:  ${e}`),loadSequence(e),document.getElementById("current-sequence-display").textContent=`Sequence ${currentSequence}`,updateActiveQuickPlayButton()}function createQuickPlayButton(e){const t=document.createElement("div");t.classList.add("quick-play-button","tooltip"),t.dataset.sequenceIndex=e,t.innerHTML=e;const n=document.createElement("span");return n.classList.add("tooltiptext"),n.innerHTML=`Quick Load Sequence ${e}<br><br>Right click to change button colour.`,t.appendChild(n),quickPlayButtons.push(t),t.addEventListener("click",(function(){setActiveSequence(e)})),t.addEventListener("contextmenu",(function(e){e.preventDefault(),showColorPicker(e,t)})),t}quickPlayContainer.id="quickplay-container",quickPlayContainer.style.display="flex",quickPlayContainer.style.justifyContent="center",quickPlayContainer.style.marginBottom="20px",insertQuickPlayButtons(),quickPlayButtons.forEach((e=>{e.addEventListener("click",(()=>{loadAndDisplaySequence(parseInt(e.dataset.sequenceIndex,10))}))})),quickPlayButtons.forEach((e=>e.classList.add("inactive")));for(let e=0;e<=15;e++){let t=channelTemplate.cloneNode(!0);t.id=`channel-${e}`,mainContainer.appendChild(t)}channelTemplateContainer.remove();const setupCompleteEvent=new Event("setupComplete");window.dispatchEvent(setupCompleteEvent);</script>
<script>let isCopyPasteEvent=!1,copiedData=null;function validateAndUpdateUI(e){isValidSequence(window.unifiedSequencerSettings.getSequenceSettings(e))?(updateUIForSequence(e),console.log(`[copyPasteDebug] UI updated for sequence index: ${e}`)):console.error(`[copyPasteDebug] Invalid sequence settings for sequence index: ${e}`)}function isValidSequence(e){if(!e||"object"!=typeof e)return console.log("[copyPasteDebug] Sequence is not an object."),!1;for(let t in e){if(!isValidChannel(e[t]))return console.log(`[copyPasteDebug] Invalid channel data in sequence: ${t}`),!1}return console.log("[copyPasteDebug] Sequence is valid for paste."),!0}function isValidChannel(e){return e&&Array.isArray(e.steps)&&"boolean"==typeof e.mute&&"string"==typeof e.url}function showConfirmationTooltip(e){const t=document.createElement("div");t.innerText=e,t.style.position="absolute",t.style.background="#333",t.style.color="white",t.style.padding="5px",t.style.borderRadius="5px",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.zIndex="1000",document.body.appendChild(t),setTimeout((()=>{t.remove()}),3e3)}document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("copy-sequence-settings"),t=document.getElementById("paste-button");e&&(console.log("[copyPasteDebug] Copy button clicked."),e.addEventListener("click",(function(){const e=window.unifiedSequencerSettings.getCurrentSequence(),n=window.unifiedSequencerSettings.getSequenceSettings(e);copiedData={type:"sequence",sequenceSettings:JSON.parse(JSON.stringify(n))},console.log("[copyPasteDebug] Sequence settings copied:",copiedData),t&&t.classList.add("flashing"),showConfirmationTooltip("[copyPasteDebug] Copied sequence settings. Select another sequence to paste to.")}))),t&&t.addEventListener("click",(function(){if(console.log("[copyPasteDebug] pasteButton clicked"),!copiedData||"sequence"!==copiedData.type)return void alert("No sequence data copied to paste!");const e=window.unifiedSequencerSettings.getCurrentSequence();console.log(`[copyPasteDebug] Current sequence index: ${e}`),window.unifiedSequencerSettings.setSequenceSettings(e,copiedData.sequenceSettings),console.log(`[copyPasteDebug] Sequence settings pasted to sequence index ${e}: ${JSON.stringify(copiedData)}`),updateUIForSequence(e),console.log(`[copyPasteDebug] updateUIForSequence called with sequence index: ${e}`),console.log(`[copyPasteDebug] Current sequence index according to the global object is now: ${window.unifiedSequencerSettings.getCurrentSequence()}`),this.classList.remove("flashing"),validateAndUpdateUI(e)}))}));</script>
<script>let totalSequenceCount=16,isContinuousPlay=!0;function initializeNewSequence(e){console.log("initializeNewSequence entered"),console.log(`[initializeNewSequence] Initializing new sequence. Current sequence: ${e}`);let n=Array(16).fill().map((()=>[null].concat(Array(64).fill(!1)))),t=e+1;console.log(`[initializeNewSequence] New sequence: ${e}`),window.unifiedSequencerSettings.setCurrentSequence(t,n),console.log(`[SeqDebug] [initializeNewSequence] newSequenceCreated ${e} ${n}`)}function loadSequence(e){console.log("loadSequence entered");let n=window.unifiedSequencerSettings.getSettings("projectSequences")[`Sequence${e}`];console.log(`[loadSequence] Loading sequence ${e}...`),"object"==typeof n?(updateUIForSequence(e),Object.entries(n).forEach((([n,t])=>{const o=parseInt(n.replace("ch",""),10);updateChannelUI(e,o,t.steps)}))):console.error(`Sequence ${e} is not an object.`,n)}function loadNextSequence(){console.log("loadNextSequence entered");let e=window.unifiedSequencerSettings.getCurrentSequence();if(e<totalSequenceCount-1){const n=e+1;console.log(`[SeqDebug] Calling handleSequenceTransition with sequence: ${n}`),handleSequenceTransition(n),updateSequenceDisplay(n)}else console.warn("You've reached the last sequence.")}function updateChannelUI(e,n,t){console.log("updateChannelUI entered"),console.log(`[SeqDebug] [updateChannelUI] Updating UI for sequence ${e} channel ${n}`);const o=document.querySelector(`.channel[data-id="Channel-${n}"]`);if(!o)return void console.error(`Channel element not found for index: ${n}`);o.querySelectorAll(`.step-button[id^="Sequence${e}-ch${n}"]`).forEach(((e,n)=>{t[n]?e.classList.add("selected"):e.classList.remove("selected")}))}function updateSequenceDisplay(e){const n=document.getElementById("current-sequence-display");n&&(n.textContent="Sequence "+e),updateActiveQuickPlayButton()}function updateUIForSequence(e){console.log("updateUIForSequence entered"),console.log(`[SeqDebug] [updateUIForSequence] Updating UI for Sequence ${e}`);const n=window.unifiedSequencerSettings.getSettings("masterSettings").projectSequences[`Sequence${e}`];console.log(`[SeqDebug] [debugging Step Button IDs] Sequence Settings for Sequence ${e}:`,n),e>=0&&e<64?channels.forEach(((t,o)=>{const c=t.querySelectorAll(".step-button"),u=t.querySelectorAll(".toggle-mute");console.log(`[SeqDebug] [debugging Step Button IDs][updateUIForSequence] Processing Channel: ${o}, Step Buttons Found: ${c.length}`),n&&n[`ch${o}`]&&n[`ch${o}`].steps?(c.forEach((e=>e.classList.remove("selected"))),u.forEach((e=>e.classList.remove("toggle-mute"))),n[`ch${o}`].steps.forEach(((e,n)=>{console.log(`[SeqDebug][debugging Step Button IDs] [updateUIForSequence] Channel: ${o}, Position: ${n}, Step State: ${e}`),e&&(c[n]?(c[n].classList.add("selected"),console.log(`[SeqDebug][debugging Step Button IDs][updateUIForSequence] Adding 'selected' class to Step Button at Position: ${n} in Channel: ${o}`)):console.error(`[SeqDebug][debugging Step Button IDs][updateUIForSequence] Step Button not found at Position: ${n} in Channel: ${o}`))}))):console.error(`[SeqDebug][debugging Step Button IDs][updateUIForSequence] Missing step data for Channel: ${o} in Sequence: ${e}`)})):console.error("[SeqDebug][debugging Step Button IDs] [updateUIForSequence] Invalid sequence number:",e)}function changeSequence(e){console.log("changeSequence entered"),currentSequence=e,onSequenceOrDataChange()}function updateStep(e,n,t){console.log("updateStep entered"),channelSettings[e][n]=t,window.unifiedSequencerSettings.updateStepState(currentSequence,e,n,t),console.log(`updateStepState called with sequence: ${currentSequence}, channelIndex: ${e}, stepIndex: ${n}, state: ${t}`)}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("continuous-play");e.addEventListener("click",(()=>{isContinuousPlay=!isContinuousPlay,e.classList.toggle("selected",isContinuousPlay)}))})),window.addEventListener("setupComplete",(function(){loadAndDisplaySequence(0)})),document.getElementById("next-sequence").addEventListener("click",(function(){console.log("Next sequence button clicked."),loadNextSequence()})),document.getElementById("prev-sequence").addEventListener("click",(function(){console.log("Previous sequence button clicked.");let e=window.unifiedSequencerSettings.getCurrentSequence();if(console.log(`Current sequence before decrement: ${e}`),e>0){const n=e-1;console.log(`[SeqDebug] Calling handleSequenceTransition with sequence: ${n}`),handleSequenceTransition(n),updateSequenceDisplay(n)}else console.warn("You're already on the first sequence.")})),console.log("Initial channel settings:",window.unifiedSequencerSettings.getSettings("projectSequences"));</script>
<script>const appContainer=document.getElementById("drum-machine");appContainer.addEventListener("click",(()=>{audioContext.resume().then((()=>{console.log("Playback resumed successfully")}))})),document.addEventListener("DOMContentLoaded",(function(){document.getElementById("save-button");let e=document.getElementById("load-file-input"),n=document.getElementById("new-load-button"),t=document.getElementById("loadOptions"),o=document.getElementById("loadJson"),l=!1;n.addEventListener("click",(()=>{console.log("[Save/Load debug] Load button clicked"),l||(n.classList.remove("smooth-wave"),n.style.animation="none",l=!0),t.style.display="none"===t.style.display||""===t.style.display?"block":"none"})),o.addEventListener("click",(()=>{console.log("[Save/Load debug] loadJson clicked"),e.click(),t.style.display="none"})),e.addEventListener("change",(()=>{console.log("[Save/Load debug] loadFileInput change event");let n=e.files[0],t=new FileReader;t.onload=async function(e){console.log("File read start");let n=JSON.parse(e.target.result);if(console.log("[loadFileInput] File content:",n),window.unifiedSequencerSettings.loadSettings(n),n.channelURLs&&Array.isArray(n.channelURLs))for(let e=0;e<n.channelURLs.length;e++){const t=n.channelURLs[e];if(t){const n=document.getElementById(`load-sample-button-${e}`);await fetchAudio(t,e,n)}}},t.readAsText(n)}))})),window.addEventListener("message",(function(e){})),document.querySelector(".close-button").addEventListener("click",(function(){console.log("Close button clicked"),document.getElementById("audio-trimmer-modal").style.display="none",console.log("Modal closed")})),window.onclick=function(e){const n=document.getElementById("audio-trimmer-modal");e.target===n&&(console.log("Clicked outside the modal"),n.style.display="none",console.log("Modal closed"))},document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("project-name");e.addEventListener("input",(()=>{const n=e.value.trim();window.unifiedSequencerSettings.updateSetting("projectName",n),n||(e.value="Default Project Name")}))}));</script>
<script>const sequencerChannel=new BroadcastChannel("sequencerChannel");function emitMessage(e,t){sequencerChannel.postMessage({type:e,data:t})}function emitBar(e){emitMessage("bar",{bar:e})}function emitBeat(e,t){emitMessage("beat",{beat:e,bar:t})}function emitPause(){emitMessage("pause",{})}function emitResume(){emitMessage("resume",{})}function emitStop(){emitMessage("stop",{})}function emitPlay(){emitMessage("play",{}),emitMessage("beat",{beat:beatCount,bar:barCount})}</script>
<script>function setChannelVolume(e,n){console.log("{channelSettings.js} setChannelVolume: channelIndex:",e,"volume:",n);const a=document.querySelector(`.channel[data-id="Channel-${e}"]`);a.dataset.volume=n,updateChannelVolume(a)}function updateChannelVolume(e){console.log("{channelSettings.js} updateChannelVolume: channel:",e);const n=parseFloat(e.dataset.volume);gainNodes[parseInt(e.dataset.id.split("-")[1])].gain.value=n}</script>
<script>function setupLoadSampleModalButton(e,t){const n=e.querySelector(".load-sample-button");n.textContent=window.unifiedSequencerSettings.settings.masterSettings.channelURLs[t],updateModalButtonText(n,t),openModal(t,n)}function openModal(e,t){const n=createModal(),o=createModalContent();n.appendChild(o),o.appendChild(createTextParagraph("Enter an Ordinal ID to load a Bitcoin Audional:"));const a=createInputField("Enter ORD ID:");o.appendChild(a),o.appendChild(createTextParagraph("Or, enter an IPFS ID for an off-chain Audional:"));const d=createInputField("Enter IPFS ID:");o.appendChild(d),addInputListeners(a,d),o.appendChild(createButton("Load Sample ID",(()=>handleLoad(e,a,d,n,t)),"loadButton","Load Audio from ID")),o.appendChild(createButton("Cancel",(()=>document.body.removeChild(n)),"cancelButton","Close this window"));const l=createExternalLinkButton("Search Ordinal Audio Files","https://ordinals.hiro.so/inscriptions?f=audio&s=genesis_block_height&o=asc","searchButton","Search for audio files (Copy and paste the Ordinal ID to load a sample");o.appendChild(l),document.body.appendChild(n)}function createModal(){const e=document.createElement("div");return e.className="loadSampleModalButton",e}function createModalContent(){const e=document.createElement("div");return e.className="loadSampleModalButton-content",e}function updateModalButtonText(e,t){const n=window.unifiedSequencerSettings.settings.masterSettings.projectChannelNames[t];e.textContent=n||`Load new audience (${t})`}function createTextParagraph(e){const t=document.createElement("p");return t.textContent=e,t.className="loadSampleModalButton-text",t}function createInputField(e){const t=document.createElement("input");return t.type="text",t.placeholder=e,t.className="loadSampleModalButton-input",t}function addInputListeners(e,t){e.addEventListener("input",(()=>{t.disabled=!!e.value})),t.addEventListener("input",(()=>{e.disabled=!!t.value}))}function createButton(e,t,n,o){const a=document.createElement("div");a.className="tooltip";const d=document.createElement("button");d.textContent=e,d.addEventListener("click",t),d.className=n,a.appendChild(d);const l=document.createElement("span");return l.className="tooltiptext",l.textContent=o,a.appendChild(l),a}function handleLoad(e,t,n,o,a){let d;if(console.log(`[HTML Debugging] [handleLoad] Called with index: ${e}`),t.value)d="https://ordinals.com/content/"+t.value;else{if(!n.value)return void console.log("[HTML Debugging] [handleLoad] No input value found.");d="https://ipfs.io/ipfs/"+n.value}d=formatURL(d),fetchAudio(d,e).then((()=>{console.log(`[HTML Debugging] [handleLoad] Audio loaded for channel ${e}: ${d}`),window.unifiedSequencerSettings.addChannelURL(e,d)})).catch((e=>{console.error(`[HTML Debugging] [handleLoad] Error loading audio for URL ${d}:`,e)})),document.body.removeChild(o),console.log(`[HTML Debugging] [handleLoad] Modal removed for channel ${e}`)}function createExternalLinkButton(e,t,n,o){const a=document.createElement("div");a.className="tooltip";const d=document.createElement("button");d.textContent=e,d.className=n,d.addEventListener("click",(()=>window.open(t,"_blank"))),a.appendChild(d);const l=document.createElement("span");return l.className="tooltiptext",l.textContent=o,a.appendChild(l),a}</script>
<script>window.addEventListener("DOMContentLoaded",(e=>{console.log("channelsForeach.js entered"),channels.forEach(((e,t)=>{e.dataset.id=`Channel-${t}`;const n=audioContext.createGain();n.gain.value=1,n.connect(audioContext.destination),gainNodes[t]=n;const o=e.querySelector(".mute-button");o.addEventListener("click",(()=>{console.log(`Mute button clicked for Channel-${t}`);const n=o.classList.toggle("selected");updateMuteState(e,n),updateDimState(e,t)}));const c=e.querySelector(".solo-button");c.addEventListener("click",(()=>{soloedChannels[t]=!soloedChannels[t],c.classList.toggle("selected",soloedChannels[t]),channels.forEach(((e,n)=>{t===n?updateMuteState(e,!1):updateMuteState(e,soloedChannels[t]),updateDimState(e,n)}))}));const l=e.querySelector(".clear-button");let a;e.querySelector(".clear-confirm"),l.addEventListener("click",(n=>{if(n.stopPropagation(),l.classList.contains("flashing")){e.querySelectorAll(".step-button").forEach((e=>{e.classList.remove("selected")}));let n=Array(64).fill(!1);for(let e=0;e<n.length;e++)window.unifiedSequencerSettings.updateStepState(currentSequence,t,e,n[e]);clearTimeout(a),l.classList.remove("flashing")}else l.classList.add("flashing"),a=setTimeout((()=>{l.classList.remove("flashing")}),2e3)})),document.addEventListener("click",(e=>{!l.contains(e.target)&&l.classList.contains("flashing")&&(clearTimeout(a),l.classList.remove("flashing"))}));const s=e.querySelector(".load-sample-button");function i(e){const t=document.querySelector(".custom-context-menu");t&&!t.contains(e.target)&&r()}function d(e,t){const n=document.createElement("div");return n.textContent=e,Object.assign(n.style,{padding:"5px 10px",cursor:"pointer"}),n.addEventListener("mouseenter",(()=>n.style.backgroundColor="#f0f0f0")),n.addEventListener("mouseleave",(()=>n.style.backgroundColor="lightgray")),n.addEventListener("click",t),n}function r(){const e=document.querySelector(".custom-context-menu");e&&e.remove()}function u(){const e=document.querySelector(".channel-naming-modal");e&&document.body.removeChild(e)}s.addEventListener("click",(()=>{setupLoadSampleModalButton(e,t)})),s.addEventListener("contextmenu",(e=>{console.log("Right-click on loadSampleButton"),e.preventDefault(),function(e,t,n,o,c){console.log("Creating custom context menu"),r();const l=function(e,t){const n=document.createElement("div");return n.className="custom-context-menu",Object.assign(n.style,{position:"absolute",top:`${t}px`,left:`${e}px`,backgroundColor:"lightgray",color:"black",padding:"10px",border:"1px solid #ddd",borderRadius:"5px",boxShadow:"0px 2px 5px rgba(0,0,0,0.2)"}),n}(t,n),a=d("Add User Channel Name",(()=>{!function(e){u();const t=document.createElement("div");t.className="channel-naming-modal";const n=document.createElement("input");n.type="text",n.placeholder="Give this channel a name",n.className="channel-name-input";const o=document.createElement("button");o.textContent="Submit",o.onclick=()=>{n.value&&window.unifiedSequencerSettings.setProjectChannelName(e,n.value),u()};const c=document.createElement("button");c.textContent="Cancel",c.onclick=u,t.appendChild(n),t.appendChild(o),t.appendChild(c),document.body.appendChild(t),document.addEventListener("click",(e=>{t.contains(e.target)||e.target.matches(".load-sample-button")||u()}),{capture:!0,once:!0})}(o),r()})),s=d("Copy Ordinal ID",(()=>{!function(e){const t=window.unifiedSequencerSettings.channelURLs(e);t?navigator.clipboard.writeText(t).then((()=>console.log("Full URL copied:",t))).catch((e=>console.error("Error copying URL:",e))):console.log("No URL found for channel:",e)}(o),console.log("Copy Ordinal ID clicked"),r()})),p=d("Copy Channel Settings (coming soon)",(()=>{console.log("Copy Channel Settings clicked"),r()})),g=d("Set Channel Colour",(()=>{console.log("Set Channel Colour option selected"),function(e,t){console.log("showColorPicker function called inside channelsForEach.js");const n=["#FF0000","#00FF00","#0000FF","#FFFF00","#00FFFF","#FF00FF","#808080","#FFFFFF","#FFA500","#800080","#008080","#000080","#800000","#008000","#FFC0CB","#D2691E"],o=document.createElement("div");o.style.position="absolute",o.style.display="grid",o.style.gridTemplateColumns="repeat(4, 1fr)",o.style.gap="1px";const c=n.length/4*20,l=e.clientY-c,a=e.clientX;console.log(`Color picker position - Top: ${l}px, Left: ${a}px`),o.style.top=l+"px",o.style.left=a+"px",n.forEach((e=>{const n=document.createElement("div");n.style.width="20px",n.style.height="20px",n.style.backgroundColor=e,n.addEventListener("click",(function(){console.log(`Color selected: ${e}`),t.style.backgroundColor=e,t.className=t.className.replace(/\bcolor-[^ ]+/g,""),t.classList.add(`color-${e.replace("#","")}`),o.remove()})),o.appendChild(n)})),document.body.appendChild(o),console.log("Color picker appended to the body. Check if it is visible in the DOM."),o.addEventListener("click",(function(e){e.stopPropagation()})),setTimeout((()=>{document.addEventListener("click",(function e(){console.log("Global click detected. Removing color picker."),o.remove(),document.removeEventListener("click",e)}))}),0),setTimeout((()=>{console.log("Removing color picker after 2 seconds."),o.remove()}),5e3)}(e,c),r()})),m=d("Paste Ordinal ID",(()=>{!function(e){navigator.clipboard.readText().then((t=>{if(isValidURL(t)){let n=[...window.unifiedSequencerSettings.settings.masterSettings.channelURLs];n[e]=t,window.unifiedSequencerSettings.setChannelURLs(n),console.log("Pasted full URL:",t)}else console.error("Invalid URL format.")})).catch((e=>console.error("Error pasting URL:",e)))}(o),r()})),h=d("Paste Channel Settings (coming soon)",(()=>{!function(e){navigator.clipboard.readText().then((t=>{let n=JSON.parse(t);window.unifiedSequencerSettings.setChannelSettings(e,n),console.log("Pasted Channel Settings:",n)})).catch((e=>console.error("Error pasting Channel Settings:",e)))}(o),r()}));l.appendChild(a),l.appendChild(g),l.appendChild(s),l.appendChild(m),l.appendChild(p),l.appendChild(h),document.body.appendChild(l),setTimeout((()=>{document.addEventListener("click",i,{capture:!0,once:!0})}),0)}(e,e.pageX,e.pageY,t,s)}))})),console.log("channelsForeach.js entered"),channels.forEach(((e,t)=>{}))}));</script>
<script>function createStepButtonsForSequence(){console.log("[createStepButtonsForSequence] [SeqDebug] entered"),channels.forEach(((e,t)=>{const n=e.querySelector(".steps-container");n.innerHTML="";let s=window.unifiedSequencerSettings.settings.masterSettings.currentSequence;for(let c=0;c<64;c++){const o=document.createElement("button");o.classList.add("step-button"),o.id=`Sequence${s}-ch${t}-step-${c}`,o.addEventListener("click",(()=>{let n=window.unifiedSequencerSettings.getStepState(s,t,c);if(window.unifiedSequencerSettings.updateStepState(s,t,c,!n),o.classList.toggle("selected")){const t=e.querySelector(".load-sample-button").className.match(/\bcolor-[^ ]+/);t?o.classList.add(t[0]):o.style.backgroundColor="var(--accent-color)"}else o.classList.remove(...o.classList),o.classList.add("step-button"),o.style.backgroundColor="";updateSpecificStepUI(s,t,c)})),n.appendChild(o)}console.log(`[createStepButtonsForSequence] Completed creating step buttons for Channel ${t} in Sequence ${s}.`)}))}document.addEventListener("DOMContentLoaded",createStepButtonsForSequence);</script>
<script>let totalNumberOfSequences=16;function handleStep(e,t,n){console.log("handleStep entered");let o="true"===e.dataset.muted;return t.toggleMuteSteps.includes(n)&&(o=!o,e.dataset.muted=o?"true":"false",updateMuteState(e,o),console.log("Mute toggled by the handleStep function")),o}function renderPlayhead(e,t){console.log("renderPlayhead entered"),e.forEach(((e,n)=>{e.classList.remove("playing"),e.classList.remove("triggered"),n===t&&e.classList.add("playing"),e.classList.contains("selected")&&e.classList.add("triggered")}))}function playStep(){console.log("[stepHandling][playStep] Function entered");const e=window.unifiedSequencerSettings.getCurrentSequence(),t=presets.preset1;for(let n=0;n<16;n++){console.log(`[playStep] Processing channel index: ${n}`);const o=channels[n],u=o.querySelectorAll(".step-button");let r=t.channels[n];r||(console.warn(`No preset data for channel index: ${n}`),r={steps:Array(4096).fill(!1),mute:!1,url:null}),renderPlayhead(u,currentStep);const l=handleStep(o,r,totalStepCount);console.log(`[playStep] Mute state for channel index ${n}: ${l}`),playSound(e,o,currentStep),console.log(`[playStep] Playing sound for current sequence: ${e}, channel index: ${n}, current step: ${currentStep}`)}incrementStepCounters();if(document.getElementById("continuous-play").checked&&0===currentStep){handleSequenceTransition((e+1)%totalNumberOfSequences)}}function incrementStepCounters(){currentStep=(currentStep+1)%64,totalStepCount+=1,nextStepTime+=stepDuration,currentStep%4==0&&(beatCount++,emitBeat(beatCount)),currentStep%16==0&&(barCount+=1,emitBar(barCount)),currentStep%64==0&&(sequenceCount++,console.log(`[playStep-count] Sequence count: ${sequenceCount}`)),console.log(`[SeqDebug][playStep-count] Next step time: ${nextStepTime}`)}function handleSequenceTransition(e){console.log("[SeqDebug][stepHandling] handleSequenceTransition entered"),console.log(`[SeqDebug] handleSequenceTransition called with sequence: ${e}`),window.unifiedSequencerSettings.setCurrentSequence(e),console.log(`[SeqDebug][stepHandling] Sequence set to ${e} at ${(new Date).toLocaleTimeString()}`);const t=document.getElementById("current-sequence-display");t&&(t.innerHTML=`Sequence: ${e}`),resetCountersForNewSequence(),createStepButtonsForSequence(),setTimeout((()=>{updateUIForSequence(e),console.log(`[SeqDebug][handleSequenceTransition][stepHandling] UI updated for sequence ${e} at ${(new Date).toLocaleTimeString()}`)}),100)}function resetCountersForNewSequence(){beatCount=0,barCount=0,currentStep=0,totalStepCount=0}</script>
<script>function startScheduler(){channels.forEach((e=>{const t=parseInt(e.dataset.id.split("-")[1]);channelMutes[t]||setChannelVolume(t,1)})),clearTimeout(timeoutId),audioContext.resume(),startTime=audioContext.currentTime,nextStepTime=startTime;const e=window.unifiedSequencerSettings.getBPM();console.log(`[startScheduler] Current BPM from global settings: ${e}`),scheduleNextStep()}function pauseScheduler(){clearTimeout(timeoutId),audioContext.suspend(),pauseTime=audioContext.currentTime,isPaused=!0}function resumeScheduler(){isPaused&&(audioContext.resume(),nextStepTime=audioContext.currentTime,isPaused=!1),scheduleNextStep()}function scheduleNextStep(){console.log("[scheduleNextStep] Attempting to play sound for Channel:","Step:",currentStep);const e=window.unifiedSequencerSettings.getBPM()||105;console.log(`[scheduleNextStep] Current BPM: ${e}`),stepDuration=60/e/4,console.log(`[scheduleNextStep] Step Duration: ${stepDuration}`),timeoutId=setTimeout((()=>{playStep(),scheduleNextStep()}),1e3*(nextStepTime-audioContext.currentTime))}function stopScheduler(){channels.forEach((e=>{setChannelVolume(parseInt(e.dataset.id.split("-")[1]),0)})),clearTimeout(timeoutId),currentStep=0,beatCount=1,barCount=1,sequenceCount=0,isPaused=!1,pauseTime=0}function resetStepLights(){document.querySelectorAll(".step-button").forEach((e=>{e.classList.remove("playing")}))}</script>
<script>const presets={preset1:{name:"Preset 1",bpm:"105",channels:[{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!0,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""},{triggers:[],mute:!1,toggleMuteSteps:[],url:""}]}};console.log("Initial Presets:",presets);</script>
<script>const audioBuffers=new Map;function getIDFromURL(e){console.log("[HTML Debugging] getIDFromURL entered");const t=e.split("/");return t[t.length-1]}function base64ToArrayBuffer(e){console.log("[HTML Debugging] [base64ToArrayBuffer] Entered function. Base64 sample:",e.substring(0,100));const t=atob(e),o=t.length,n=new Uint8Array(o);for(let e=0;e<o;e++)n[e]=t.charCodeAt(e);return console.log(`[HTML Debugging] [base64ToArrayBuffer] Generated Uint8Array length: ${n.length}`),n.buffer}const decodeAudioData=e=>{let t=new Uint8Array(e.slice(0,20));return console.log("[HTML Debugging] [decodeAudioData] ArrayBuffer first 20 bytes:",t.join(", ")),new Promise(((t,o)=>{audioContext.decodeAudioData(e,(e=>{console.log("[HTML Debugging] [decodeAudioData] Audio data decoded successfully."),t(e)}),(e=>{console.error("[HTML Debugging] [decodeAudioData] Detailed Error:",{message:e.message,code:e.code}),o(e)}))}))},fetchAudio=async(e,t)=>{const o=formatURL(e);console.log("[HTML Debugging] [fetchAudio] Entered function. URL:",o,"Channel Index:",t);try{const e=await fetch(o),n=e.headers.get("Content-Type");let a;if(n&&n.includes("text/html")){const o=await e.text(),n=await importHTMLAudioData(o,t);if(!n)return;a=n.startsWith("data:")?base64ToArrayBuffer(n.split(",")[1]):await fetch(n).then((e=>e.arrayBuffer()))}else a=await e.arrayBuffer();const r=await decodeAudioData(a);audioBuffers.set(o,r),console.log("[HTML Debugging] [fetchAudio] Audio buffer stored.")}catch(e){console.error("[HTML Debugging] [fetchAudio] Error:",e)}};async function importHTMLAudioData(e,t){console.log("[importHTMLSampleData] Entered function with index: ",t);try{const t=new DOMParser,o=t.parseFromString(e,"text/html").querySelector("audio[data-audionalSampleName] source");if(o){const e=o.getAttribute("src");if(e.toLowerCase().startsWith("data:audio/wav;base64,")||e.toLowerCase().startsWith("data:audio/mp3;base64,"))return console.log("[importHTMLSampleData] Extracted base64 audio data."),e;console.error("[importHTMLSampleData] Audio data does not start with expected base64 prefix.")}else console.error("[importHTMLSampleData] Could not find the audio source element in the HTML content.")}catch(e){console.error("[importHTMLSampleData] Error parsing HTML content: ",e)}return null}function bufferToBase64(e){console.log("bufferToBase64 entered");let t="";const o=new Uint8Array(e),n=o.byteLength;console.log(`[HTML Debugging] [bufferToBase64] Buffer length: ${n}`);for(let e=0;e<n;e++)t+=String.fromCharCode(o[e]);const a=window.btoa(t);return console.log(`[HTML Debugging] [bufferToBase64] Converted to base64, length: ${a.length}`),a}function playSound(e,t,o){console.log("playSound entered");const n=getChannelIndex(t);console.log(`[playSound Debugging] [playSound] Processing channel index: ${n}`);const a=getStepState(e,n,o);if(console.log(`[playSound Debugging] [playSound] setting stepState using getStepState to: ${a}`),!a)return void console.log("[playSound Debugging] [playSound] Current step is not selected. Skipping playback.");const r=getAudioUrl(n);console.log("[playSound Debugging] [playSound] Audio URL:",r);const i=getAudioBuffer(r);i?(console.log("[playSound Debugging] [playSound] Audio buffer:",i),playTrimmedAudio(n,i,r)):console.log("[playSound Debugging] [playSound] No audio buffer found for URL:",r)}function getChannelIndex(e){return parseInt(e.dataset.id.split("-")[1])}function getStepState(e,t,o){return console.log(`[playSound Debugging] [getStepState called] currentSequence: ${e}, channelIndex: ${t}, currentStep: ${o}`),window.unifiedSequencerSettings.getStepState(e,t,o)}function getAudioUrl(e){return void 0===window.unifiedSequencerSettings.getprojectUrlforChannel(e)?(console.error(`[getAudioUrl] [ playSound ] URL not found for channel index: ${e}`),"defaultURL"):window.unifiedSequencerSettings.getprojectUrlforChannel(e)}function getAudioBuffer(e){return audioBuffers.get(e)}function playTrimmedAudio(e,t,o){console.log("playTrimmedAudio entered"),console.log("[playTrimmedAudio] Audio buffer found for URL:",o);const n=audioContext.createBufferSource();n.buffer=t;const{trimStart:a,duration:r}=calculateTrimValues(e,t);n.connect(gainNodes[e]),gainNodes[e].connect(audioContext.destination),console.log(`[debug - playSound] Playing audio from URL: ${o} for channel index: ${e} at trimStart: ${a} and duration: ${r}`),n.start(0,a,r)}function calculateTrimValues(e,t){const o=window.unifiedSequencerSettings.getTrimSettings(e);let n=o.startSliderValue/100*t.duration,a=o.endSliderValue/100*t.duration;return n=Math.max(0,Math.min(n,t.duration)),a=Math.max(n,Math.min(a,t.duration)),{trimStart:n,duration:a-n}}async function playAuditionedSample(e){console.log("playAuditionedSample entered");try{const t=formatURL(e),o=await fetch(t),n=await o.json();if(n.audioData){const e=base64ToArrayBuffer(n.audioData.split(",")[1]);audioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,audioContext=new AudioContext);const t=await decodeAudioData(e),o=audioContext.createBufferSource();o.buffer=t,o.connect(audioContext.destination),o.start()}else{console.log("Audional data not found in response, attempting to fetch and parse content type.");const t=await fetchAndParseContentType(e);console.log(`Content type found: ${t}`)}}catch(e){console.error("Error playing auditioned sample:",e)}}function togglePlayState(e,t,o,n){console.log("togglePlayState entered"),e||(e=!0,t(),o.classList.add("selected"),n.classList.remove("selected"))}function updateMuteState(e,t){console.log("updateMuteState entered"),console.log("updateMuteState - isMuted: "+t);const o=parseInt(e.dataset.id.split("-")[1]);e.dataset.muted=t?"true":"false";e.querySelector(".mute-button").classList.toggle("selected",t),channelMutes[o]=t,gainNodes[o].gain.value=t?0:1,updateDimState(e,o)}function toggleMute(e){console.log("toggleMute entered");const t=parseInt(e.dataset.id.split("-")[1]);updateMuteState(e,!channelMutes[t],t),console.log("Mute has been toggled by the toggleMute function")}</script>
<script>function updateProjectNameObserver(e){console.log("[observers] updateProjectNameObserver called with:",e),e&&e.masterSettings&&e.masterSettings.projectName&&(console.log("[observers] Updating Project Name UI:",e.masterSettings.projectName),updateProjectNameUI(e.masterSettings.projectName))}function updateBPMObserver(e){console.log("[observers] updateBPMObserver called with:",e),e&&e.masterSettings&&e.masterSettings.projectBPM&&(console.log("Updating BPM UI:",e.masterSettings.projectBPM),updateBPMUI(e.masterSettings.projectBPM))}function updateProjectURLsObserver(e){console.log("[observers] updateProjectURLsObserver called with:",e),e&&e.masterSettings&&e.masterSettings.projectURLs&&(console.log("Updating Project URLs UI:",e.masterSettings.projectURLs),unifiedSequencerSettings.updateAllLoadSampleButtonTexts(),updateProjectURLsUI(e.masterSettings.projectURLs))}function updateTrimSettingsObserver(e){console.log("[observers] updateTrimSettingsObserver called with:",e),e&&e.masterSettings&&e.masterSettings.trimSettings&&(console.log("Updating Trim Settings UI:",e.masterSettings.trimSettings),updateTrimSettingsUI(e.masterSettings.trimSettings))}function updateProjectChannelNamesObserver(e){console.log("[observers] updateProjectChannelNamesObserver called with:",e),e&&e.masterSettings&&e.masterSettings.projectChannelNames&&(console.log("Updating Project channel Names UI:",e.masterSettings.projectChannelNames),e.masterSettings.projectChannelNames.forEach(((e,t)=>{const r=document.querySelector(`#channel-name-${t}`);r&&(r.textContent=e||"Default Channel Name")})))}function updateProjectSequencesObserver(e){console.log("[observers] updateProjectSequencesObserver called with:",e),e&&e.masterSettings&&e.masterSettings.projectSequences&&(console.log("Updating Project Sequences UI:",e.masterSettings.projectSequences),updateProjectSequencesUI(e.masterSettings.projectSequences))}function registerObservers(){console.log("[observers] registerObservers called"),window.unifiedSequencerSettings?(window.unifiedSequencerSettings.addObserver(updateProjectNameObserver),window.unifiedSequencerSettings.addObserver(updateBPMObserver),window.unifiedSequencerSettings.addObserver(updateProjectURLsObserver),window.unifiedSequencerSettings.addObserver(updateTrimSettingsObserver),window.unifiedSequencerSettings.addObserver(updateProjectChannelNamesObserver),window.unifiedSequencerSettings.addObserver(updateProjectSequencesObserver),window.unifiedSequencerSettings.addObserver(updateCurrentSequenceObserver),window.unifiedSequencerSettings.addObserver(updateTotalSequencesObserver)):console.error("UnifiedSequencerSettings instance not found.")}function updateCurrentSequenceObserver(e){console.log("[Observer] updateCurrentSequenceObserver called with:",e),e&&e.masterSettings&&"number"==typeof e.masterSettings.currentSequence&&console.log("[Observer] Current Sequence changed:",e.masterSettings.currentSequence)}function updateTotalSequencesObserver(e){console.log("[Observer] updateTotalSequencesObserver called with:",e),e&&e.masterSettings&&Array.isArray(e.masterSettings.projectSequences)&&console.log("[Observer] Total number of Sequences changed:",e.masterSettings.projectSequences.length)}registerObservers();</script>
<script>let isPlaying=!1,currentStep=0,totalStepCount=0,beatCount=1,barCount=1,sequenceCount=1,currentSequence=0;const sequenceLength=64,maxSequenceCount=64,allSequencesLength=4096,collectedURLs=Array(16).fill("");let timeoutId,audioContext,currentStepTime,startTime,nextStepTime,stepDuration,isPaused=!1,pauseTime=0,stopClickCount=0,playButton=document.getElementById("play"),stopButton=document.getElementById("stop"),saveButton=document.getElementById("save-button"),gainNodes=Array(16).fill(null),isMuted=!1,channelMutes=[],muteState=!1,volumeStates=Array(16).fill(1),soloedChannels=Array(16).fill(!1),channels=document.querySelectorAll('.channel[id^="channel-"]'),activeChannels=16,clearClickedOnce=Array(channels.length).fill(!1),clearConfirmTimeout=Array(channels.length).fill(null);if(!audioContext)try{window.AudioContext=window.AudioContext||window.webkitAudioContext,audioContext=new AudioContext}catch(e){console.warn("Web Audio API is not supported in this browser")}function updateVolume(e,t){if(console.log("updateVolume entered"),soloedChannels.some((e=>e)))gainNodes[t].gain.value=soloedChannels[t]?1:0;else{const n=e.querySelector(".mute-button").classList.contains("selected");gainNodes[t].gain.value=n?0:1}}function updateDimState(e,t){console.log("updateDimState entered"),console.log(`updateDimState called for channel ${t}`);const n=window.unifiedSequencerSettings.getCurrentSequence(),o=e.querySelectorAll(`.step-button[id^="Sequence${n}-ch${t}"]`);0===gainNodes[t].gain.value?o.forEach((e=>e.classList.add("dimmed"))):o.forEach((e=>e.classList.remove("dimmed")))}if(document.addEventListener("click",(()=>{channels.forEach(((e,t)=>{if(clearClickedOnce[t]){e.querySelector(".clear-confirm").style.display="none",clearTimeout(clearConfirmTimeout[t]),clearClickedOnce[t]=!1}}))})),playButton&&stopButton){const t=document.querySelector("#channel-0 .step-button:nth-child(4n)");t&&t.classList.add("selected");const n=document.querySelector("#channel-1 .step-button:nth-child(1)");n&&n.classList.add("selected");const o=document.querySelector("#channel-1 .step-button:nth-child(6)");o&&o.classList.add("selected");let l=!1;function checkContinuousPlay(){document.getElementById("continuous-play").checked&&totalStepCount>=4096&&(beatCount=0,barCount=0,currentStep=0,totalStepCount=0,document.getElementById("next-sequence").click())}playButton.addEventListener("click",(()=>{let e=document.getElementById("continuous-play").checked;isPlaying?l?(resumeScheduler(),emitResume(),l=!1):(pauseScheduler(),emitPause(),l=!0):(startScheduler(),emitPlay(),playButton.classList.add("selected"),stopButton.classList.remove("selected"),isPlaying=!0,l=!1),e&&totalStepCount>=4096&&(beatCount=0,barCount=0,sequenceCount=0,currentStep=0,totalStepCount=0,sequenceCount++,sequenceCount>64&&(sequenceCount=1),loadPreset(`preset${sequenceCount}`)),checkContinuousPlay()})),stopButton.addEventListener("click",(()=>{isPlaying&&(stopScheduler(),emitStop(),stopButton.classList.add("selected"),playButton.classList.remove("selected"),isPlaying=!1,l=!1,beatCount=0,barCount=0,sequenceCount=0,currentStep=0,totalStepCount=0,resetStepLights())}))}else console.error("Play or Stop button is not defined");const loadPreset=e=>{console.log("index.js loadPreset entered"),console.log(`index.js loadPreset: Loading preset: ${e}`);const t=presets[e];t?(channels.forEach(((e,n)=>{const o=t.channels[n];if(!o)return void console.warn(`No preset data for channel index: ${n}`);const l=window.unifiedSequencerSettings.getChannelURL(n),{steps:a,mute:s}=o;if(l){const e=document.querySelector(`.channel[data-id="Channel-${n}"] .load-sample-button`);fetchAudio(l,n,e).then((()=>{const t=getAudioTrimmerInstanceForChannel(n);t&&t.loadSampleFromURL(l).then((()=>{const l=o.trimSettings?.startSliderValue||.01,a=o.trimSettings?.endSliderValue||t.totalSampleDuration;t.setStartSliderValue(l),t.setEndSliderValue(a),window.unifiedSequencerSettings.setTrimSettings(n,l,a),updateLoadSampleButtonText(n,e)}))}))}a.forEach((e=>{const t=document.querySelector(`.channel[data-id="Channel-${n}"] .step-button:nth-child(${e})`);t&&t.classList.add("selected")}));const u=document.querySelector(`.channel[data-id="Channel-${n}"]`);u&&(updateMuteState(u,s),u.classList.add("ordinal-loaded"))})),console.log(e),loadChannelSettingsFromPreset(presets[e]),console.log("loadPreset: After loadPreset, gainNodes values:",gainNodes.map((e=>e.gain.value)))):console.error("Preset not found:",e)};function updateLoadSampleButtonText(e,t){console.log("updateLoadSampleButtonText entered"),console.log(`[updateLoadSampleButtonText] Called for channel index: ${e}`);const n=window.unifiedSequencerSettings.channelURLs(e);console.log(`[updateLoadSampleButtonText] Loaded URL for channel ${e}: ${n}`),n?(t.textContent=n,console.log(`[updateLoadSampleButtonText] Button text updated to: ${n}`)):(t.textContent="Load New Audional",console.log("[updateLoadSampleButtonText] Default text set for button"))}function testUpdateLoadSampleButtonText(){console.log("[testUpdateLoadSampleButtonText] Function entered");document.querySelectorAll(".channel").forEach(((e,t)=>{const n=e.querySelector(".load-sample-button");n?(n.textContent=`Channel ${t+1}`,console.log(`[testUpdateLoadSampleButtonText] Button text updated for channel ${t+1}`)):console.log(`[testUpdateLoadSampleButtonText] No loadSampleButton found for channel ${t+1}`)}))}console.log("index.js loaded");</script> -->
</body>
</html>