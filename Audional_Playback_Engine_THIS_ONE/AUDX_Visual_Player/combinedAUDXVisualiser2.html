<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combined Audio Visualizer</title>
    <link rel="stylesheet" href="s.css"> <!-- Assuming the CSS is applicable to the visualizer -->
    <style>
        /* Hide the play button to ensure only the visualizer is visible */
        #play { display: none; }
    </style>
</head>
<body>
    <!-- Keeping the file input for the audio data -->
    <input type="file" id="jsonInput" accept=".json" style="display: none;"> <!-- Hide the file input as well -->
    <canvas id="cv"></canvas>

    <!-- Scripts for the playback engine -->
    <script src="loadAndAnalyseAUDXFile3.js"></script>
    <!-- Other scripts might be commented out if not needed or if everything required is in the above script -->

    <!-- Scripts for the visualizer -->
    <script src="g2RotationWw.js"></script>
    <script src="c2.js"></script>
    <script src="d2DrawingWw.js"></script>

    <script>

const audioEventDispatcher = new EventTarget();

  // audioEventDispatcher.addEventListener('audioPlayback', (event) => {
    //     if (event.data.action === 'stop') {
    //         cci2 = initialCCI2; // Reset to initial cci2 value when stop is received
    //         isChannel11Active = false; // Reset channel 11 active flag
    //         console.log(`Stop received. CCI2 reset to initial value ${initialCCI2}`);
    //     } else {
    //         const { channelIndex } = event.data;
    //         cci2 = calculateCCI2(channelIndex); // Update the CCI2 with enhanced randomization
    //         console.log(`Received channel playback: Channel ${channelIndex}. CCI2 updated to ${cci2} based on seed ${seed}.`);
    //     }
    // });
    //     console.log('Received playback event:', event.detail);
    
        

    document.addEventListener('click', togglePlayback);

    async function togglePlayback() {
        console.log(`[togglePlayback] ${isPlaying ? 'Stopping' : 'Initiating'} playback...`);
        isPlaying = !isPlaying;

        if (isPlaying) {
            if (audioCtx.state === 'suspended') await audioCtx.resume();
            startPlaybackLoop();
        } else {
            await audioCtx.suspend();
            resetPlayback();
        }
    }
        function ensureAudioContextState() {
            // This function ensures the AudioContext is in a running state. It's a stub here and should be implemented in your JavaScript file if not already present.
            if (window.audioCtx && audioCtx.state === 'suspended') {
                return audioCtx.resume();
            }
            return Promise.resolve();
        }
   
        </script>
        

</body>
</html>
